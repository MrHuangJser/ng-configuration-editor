import { Injectable } from '@angular/core';
import { ComponentStore } from '@ngrx/component-store';
import { BehaviorSubject } from 'rxjs';
import { filter, map, pairwise, startWith } from 'rxjs/operators';
import { LayerTreeComponent, PropertyFormComponent, WidgetListComponent } from '../components';
import { DEFAULT_STORE } from '../store';
import * as i0 from "@angular/core";
import * as i1 from "./utils.service";
export class EditorStore extends ComponentStore {
    constructor(utils) {
        super(DEFAULT_STORE);
        this.utils = utils;
        this._defaultPanels = [
            { key: 'LAYERS', title: '图层', content: LayerTreeComponent, show: true, x: 10, y: 60 },
            { key: 'WIDGET_LIST', title: '组件', content: WidgetListComponent, show: false, x: 50, y: 60 },
            { key: 'PROPERTIES', title: '属性', content: PropertyFormComponent, show: true, x: window.innerWidth - 350, y: 60 },
        ];
        this.panels = [];
        this.panels$ = new BehaviorSubject([...this._defaultPanels, ...this.panels]);
    }
    initialize(state) {
        this.setState(state);
    }
    _get() {
        return this.get();
    }
    dispatch(action) {
        this.setState(action);
    }
    selectDifferent(cb) {
        return this.select(cb).pipe(startWith(null, cb(this.get())), pairwise(), filter(([prev, present]) => !this.utils.isDeepEqual(prev, present)), map(([, present]) => present));
    }
    toJSON() {
        const state = this.get();
        return JSON.stringify({
            canvasPosition: state.canvasPosition,
            canvasSize: state.canvasSize,
            canvasBackground: state.canvasBackground,
            nodes: state.nodes,
            selected: state.selected,
            bordered: state.bordered,
        });
    }
    addPanels(panels) {
        this.panels = [...this.panels, ...panels];
        this.panels$.next([...this._defaultPanels, ...this.panels]);
    }
    getPanel(key) {
        return [...this._defaultPanels, ...this.panels].find((panel) => panel.key === key);
    }
    updatePanelPosition(key, [x, y]) {
        [...this._defaultPanels, ...this.panels].forEach((panel) => {
            if (panel.key === key) {
                panel.x = x;
                panel.y = y;
            }
        });
        this.panels$.next([...this._defaultPanels, ...this.panels]);
    }
    togglePanelVisible(key) {
        [...this._defaultPanels, ...this.panels].forEach((panel) => {
            if (panel.key === key) {
                panel.show = !panel.show;
            }
        });
        this.panels$.next([...this._defaultPanels, ...this.panels]);
    }
    togglePanelCollapsed(key) {
        [...this._defaultPanels, ...this.panels].forEach((panel) => {
            if (panel.key === key) {
                panel.collapsed = !panel.collapsed;
            }
        });
        this.panels$.next([...this._defaultPanels, ...this.panels]);
    }
}
EditorStore.ɵfac = function EditorStore_Factory(t) { return new (t || EditorStore)(i0.ɵɵinject(i1.CeUtilsService)); };
EditorStore.ɵprov = i0.ɵɵdefineInjectable({ token: EditorStore, factory: EditorStore.ɵfac });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(EditorStore, [{
        type: Injectable
    }], function () { return [{ type: i1.CeUtilsService }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLWVkaXRvci1saWIvc3JjLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3N0b3JlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2QyxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixFQUFFLG1CQUFtQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9GLE9BQU8sRUFBRSxhQUFhLEVBQWtCLE1BQU0sVUFBVSxDQUFDOzs7QUFJekQsTUFBTSxPQUFPLFdBQXFCLFNBQVEsY0FBeUI7SUFTakUsWUFBb0IsS0FBcUI7UUFDdkMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBREgsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFSakMsbUJBQWMsR0FBa0I7WUFDdEMsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFO1lBQ3JGLEVBQUUsR0FBRyxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRTtZQUM1RixFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsS0FBSyxF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b20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29tcG9uZW50U3RvcmUgfSBmcm9tICdAbmdyeC9jb21wb25lbnQtc3RvcmUnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCwgcGFpcndpc2UsIHN0YXJ0V2l0aCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IExheWVyVHJlZUNvbXBvbmVudCwgUHJvcGVydHlGb3JtQ29tcG9uZW50LCBXaWRnZXRMaXN0Q29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50cyc7XG5pbXBvcnQgeyBERUZBVUxUX1NUT1JFLCBJUGFuZWwsIElTdG9yZSB9IGZyb20gJy4uL3N0b3JlJztcbmltcG9ydCB7IENlVXRpbHNTZXJ2aWNlIH0gZnJvbSAnLi91dGlscy5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEVkaXRvclN0b3JlPFQgPSBhbnk+IGV4dGVuZHMgQ29tcG9uZW50U3RvcmU8SVN0b3JlPFQ+PiB7XG4gIHByaXZhdGUgX2RlZmF1bHRQYW5lbHM6IElQYW5lbDxhbnk+W10gPSBbXG4gICAgeyBrZXk6ICdMQVlFUlMnLCB0aXRsZTogJ+WbvuWxgicsIGNvbnRlbnQ6IExheWVyVHJlZUNvbXBvbmVudCwgc2hvdzogdHJ1ZSwgeDogMTAsIHk6IDYwIH0sXG4gICAgeyBrZXk6ICdXSURHRVRfTElTVCcsIHRpdGxlOiAn57uE5Lu2JywgY29udGVudDogV2lkZ2V0TGlzdENvbXBvbmVudCwgc2hvdzogZmFsc2UsIHg6IDUwLCB5OiA2MCB9LFxuICAgIHsga2V5OiAnUFJPUEVSVElFUycsIHRpdGxlOiAn5bGe5oCnJywgY29udGVudDogUHJvcGVydHlGb3JtQ29tcG9uZW50LCBzaG93OiB0cnVlLCB4OiB3aW5kb3cuaW5uZXJXaWR0aCAtIDM1MCwgeTogNjAgfSxcbiAgXTtcbiAgcHJpdmF0ZSBwYW5lbHM6IElQYW5lbFtdID0gW107XG4gIHBhbmVscyQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PElQYW5lbFtdPihbLi4udGhpcy5fZGVmYXVsdFBhbmVscywgLi4udGhpcy5wYW5lbHNdKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHV0aWxzOiBDZVV0aWxzU2VydmljZSkge1xuICAgIHN1cGVyKERFRkFVTFRfU1RPUkUpO1xuICB9XG5cbiAgaW5pdGlhbGl6ZShzdGF0ZTogSVN0b3JlPFQ+KSB7XG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSk7XG4gIH1cblxuICBfZ2V0KCkge1xuICAgIHJldHVybiB0aGlzLmdldCgpO1xuICB9XG5cbiAgZGlzcGF0Y2goYWN0aW9uOiAoc3RhdGU6IElTdG9yZTxUPikgPT4gSVN0b3JlPFQ+KSB7XG4gICAgdGhpcy5zZXRTdGF0ZShhY3Rpb24pO1xuICB9XG5cbiAgc2VsZWN0RGlmZmVyZW50PFI+KGNiOiAoc3RhdGU6IElTdG9yZTxUPikgPT4gUikge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdChjYikucGlwZShcbiAgICAgIHN0YXJ0V2l0aChudWxsLCBjYih0aGlzLmdldCgpKSksXG4gICAgICBwYWlyd2lzZTxSPigpLFxuICAgICAgZmlsdGVyKChbcHJldiwgcHJlc2VudF0pID0+ICF0aGlzLnV0aWxzLmlzRGVlcEVxdWFsKHByZXYsIHByZXNlbnQpKSxcbiAgICAgIG1hcCgoWywgcHJlc2VudF0pID0+IHByZXNlbnQpXG4gICAgKTtcbiAgfVxuXG4gIHRvSlNPTigpIHtcbiAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ2V0KCk7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIGNhbnZhc1Bvc2l0aW9uOiBzdGF0ZS5jYW52YXNQb3NpdGlvbixcbiAgICAgIGNhbnZhc1NpemU6IHN0YXRlLmNhbnZhc1NpemUsXG4gICAgICBjYW52YXNCYWNrZ3JvdW5kOiBzdGF0ZS5jYW52YXNCYWNrZ3JvdW5kLFxuICAgICAgbm9kZXM6IHN0YXRlLm5vZGVzLFxuICAgICAgc2VsZWN0ZWQ6IHN0YXRlLnNlbGVjdGVkLFxuICAgICAgYm9yZGVyZWQ6IHN0YXRlLmJvcmRlcmVkLFxuICAgIH0pO1xuICB9XG5cbiAgYWRkUGFuZWxzKHBhbmVsczogSVBhbmVsW10pIHtcbiAgICB0aGlzLnBhbmVscyA9IFsuLi50aGlzLnBhbmVscywgLi4ucGFuZWxzXTtcbiAgICB0aGlzLnBhbmVscyQubmV4dChbLi4udGhpcy5fZGVmYXVsdFBhbmVscywgLi4udGhpcy5wYW5lbHNdKTtcbiAgfVxuXG4gIGdldFBhbmVsKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLl9kZWZhdWx0UGFuZWxzLCAuLi50aGlzLnBhbmVsc10uZmluZCgocGFuZWwpID0+IHBhbmVsLmtleSA9PT0ga2V5KTtcbiAgfVxuXG4gIHVwZGF0ZVBhbmVsUG9zaXRpb24oa2V5OiBzdHJpbmcsIFt4LCB5XTogW251bWJlciwgbnVtYmVyXSkge1xuICAgIFsuLi50aGlzLl9kZWZhdWx0UGFuZWxzLCAuLi50aGlzLnBhbmVsc10uZm9yRWFjaCgocGFuZWwpID0+IHtcbiAgICAgIGlmIChwYW5lbC5rZXkgPT09IGtleSkge1xuICAgICAgICBwYW5lbC54ID0geDtcbiAgICAgICAgcGFuZWwueSA9IHk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5wYW5lbHMkLm5leHQoWy4uLnRoaXMuX2RlZmF1bHRQYW5lbHMsIC4uLnRoaXMucGFuZWxzXSk7XG4gIH1cblxuICB0b2dnbGVQYW5lbFZpc2libGUoa2V5OiBzdHJpbmcpIHtcbiAgICBbLi4udGhpcy5fZGVmYXVsdFBhbmVscywgLi4udGhpcy5wYW5lbHNdLmZvckVhY2goKHBhbmVsKSA9PiB7XG4gICAgICBpZiAocGFuZWwua2V5ID09PSBrZXkpIHtcbiAgICAgICAgcGFuZWwuc2hvdyA9ICFwYW5lbC5zaG93O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMucGFuZWxzJC5uZXh0KFsuLi50aGlzLl9kZWZhdWx0UGFuZWxzLCAuLi50aGlzLnBhbmVsc10pO1xuICB9XG5cbiAgdG9nZ2xlUGFuZWxDb2xsYXBzZWQoa2V5OiBzdHJpbmcpIHtcbiAgICBbLi4udGhpcy5fZGVmYXVsdFBhbmVscywgLi4udGhpcy5wYW5lbHNdLmZvckVhY2goKHBhbmVsKSA9PiB7XG4gICAgICBpZiAocGFuZWwua2V5ID09PSBrZXkpIHtcbiAgICAgICAgcGFuZWwuY29sbGFwc2VkID0gIXBhbmVsLmNvbGxhcHNlZDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLnBhbmVscyQubmV4dChbLi4udGhpcy5fZGVmYXVsdFBhbmVscywgLi4udGhpcy5wYW5lbHNdKTtcbiAgfVxufVxuIl19