import { __decorate } from "tslib";
import { Directive, EventEmitter, Input, Output } from '@angular/core';
import { InputBoolean } from 'ng-zorro-antd/core/util';
import { fromEvent, Subscription } from 'rxjs';
import { filter, finalize, map, switchMap, takeUntil } from 'rxjs/operators';
import * as i0 from "@angular/core";
export class DraggableDirective {
    constructor(eleRef, cdr) {
        this.eleRef = eleRef;
        this.cdr = cdr;
        this.ceDragDisabled = false;
        this.ceUseSpace = false;
        this.ceOnStart = new EventEmitter();
        this.ceOnMove = new EventEmitter();
        this.ceOnStop = new EventEmitter();
        this.ceOnSpaceKeyDown = new EventEmitter();
        this.spaceKeyDown = false;
        this.subscription = new Subscription();
        this.mouseMove$ = fromEvent(window, 'pointermove');
        this.mouseUp$ = fromEvent(window, 'pointerup');
        this.keyDown$ = fromEvent(document, 'keydown');
        this.keyUp$ = fromEvent(document, 'keyup');
        this.mouseDown$ = fromEvent(this.eleRef.nativeElement, 'pointerdown').pipe(filter((e) => e.button === 0));
        this.mouseEnter$ = fromEvent(this.eleRef.nativeElement, 'pointerenter');
        this.mouseLeave$ = fromEvent(this.eleRef.nativeElement, 'pointerleave');
    }
    ngOnInit() {
        this.listenSpaceKeyEvent();
        this.mouseDown$
            .pipe(filter(() => !this.ceDragDisabled), filter(() => (this.ceUseSpace ? this.spaceKeyDown : true)), switchMap((startEv) => {
            this.ceOnStart.emit(startEv);
            return this.mouseMove$.pipe(takeUntil(this.mouseUp$.pipe(map((stopEv) => this.ceOnStop.emit(stopEv)))));
        }))
            .subscribe((moveEv) => this.ceOnMove.emit(moveEv));
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
    listenSpaceKeyEvent() {
        this.subscription.add(this.mouseEnter$
            .pipe(filter(() => !this.ceDragDisabled), filter(() => this.ceUseSpace), switchMap(() => this.keyDown$.pipe(switchMap((e) => {
            this.spaceKeyDown = e.key === ' ';
            this.cdr.detectChanges();
            if (this.spaceKeyDown) {
                e.preventDefault();
                e.stopPropagation();
            }
            return this.keyUp$;
        }), map(() => {
            this.spaceKeyDown = false;
            this.ceOnStop.emit();
        }), takeUntil(this.mouseLeave$), finalize(() => {
            this.spaceKeyDown = false;
            this.ceOnStop.emit();
        }))))
            .subscribe());
    }
}
DraggableDirective.ɵfac = function DraggableDirective_Factory(t) { return new (t || DraggableDirective)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef)); };
DraggableDirective.ɵdir = i0.ɵɵdefineDirective({ type: DraggableDirective, selectors: [["", "ceDraggable", ""]], inputs: { ceDragDisabled: "ceDragDisabled", ceUseSpace: "ceUseSpace" }, outputs: { ceOnStart: "ceOnStart", ceOnMove: "ceOnMove", ceOnStop: "ceOnStop", ceOnSpaceKeyDown: "ceOnSpaceKeyDown" }, exportAs: ["ceDraggable"] });
__decorate([
    InputBoolean()
], DraggableDirective.prototype, "ceDragDisabled", void 0);
__decorate([
    InputBoolean()
], DraggableDirective.prototype, "ceUseSpace", void 0);
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(DraggableDirective, [{
        type: Directive,
        args: [{
                selector: '[ceDraggable]',
                exportAs: 'ceDraggable',
            }]
    }], function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }]; }, { ceDragDisabled: [{
            type: Input
        }], ceUseSpace: [{
            type: Input
        }], ceOnStart: [{
            type: Output
        }], ceOnMove: [{
            type: Output
        }], ceOnStop: [{
            type: Output
        }], ceOnSpaceKeyDown: [{
            type: Output
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZ2dhYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLWVkaXRvci1saWIvc3JjLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvZHJhZ2dhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFxQixTQUFTLEVBQWMsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pILE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsU0FBUyxFQUFjLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzRCxPQUFPLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDOztBQU03RSxNQUFNLE9BQU8sa0JBQWtCO0lBd0I3QixZQUFvQixNQUErQixFQUFVLEdBQXNCO1FBQS9ELFdBQU0sR0FBTixNQUFNLENBQXlCO1FBQVUsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFyQjVFLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBR3ZCLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFFbkIsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFnQixDQUFDO1FBRTdDLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBYyxDQUFDO1FBRTFDLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBZ0IsQ0FBQztRQUU1QyxxQkFBZ0IsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQzVDLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQyxlQUFVLEdBQUcsU0FBUyxDQUFlLE1BQU0sRUFBRSxhQUFhLENBQUMsQ0FBQztRQUM1RCxhQUFRLEdBQUcsU0FBUyxDQUFlLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FB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QyxFQUMzQixRQUFRLENBQUMsR0FBRyxFQUFFO1lBQ1osSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7WUFDMUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FDSCxDQUNGLENBQ0Y7YUFDQSxTQUFTLEVBQUUsQ0FDZixDQUFDO0lBQ0osQ0FBQzs7b0ZBL0VVLGtCQUFrQjt1REFBbEIsa0JBQWtCO0FBRzdCO0lBREMsWUFBWSxFQUFFOzBEQUNlO0FBRzlCO0lBREMsWUFBWSxFQUFFO3NEQUNXO2tEQU5mLGtCQUFrQjtjQUo5QixTQUFTO2VBQUM7Z0JBQ1QsUUFBUSxFQUFFLGVBQWU7Z0JBQ3pCLFFBQVEsRUFBRSxhQUFhO2FBQ3hCOzZGQUlRLGNBQWM7a0JBRnBCLEtBQUs7WUFLQyxVQUFVO2tCQUZoQixLQUFLO1lBSUMsU0FBUztrQkFEZixNQUFNO1lBR0EsUUFBUTtrQkFEZCxNQUFNO1lBR0EsUUFBUTtrQkFEZCxNQUFNO1lBR0EsZ0JBQWdCO2tCQUR0QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSW5wdXRCb29sZWFuIH0gZnJvbSAnbmctem9ycm8tYW50ZC9jb3JlL3V0aWwnO1xuaW1wb3J0IHsgZnJvbUV2ZW50LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgZmluYWxpemUsIG1hcCwgc3dpdGNoTWFwLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tjZURyYWdnYWJsZV0nLFxuICBleHBvcnRBczogJ2NlRHJhZ2dhYmxlJyxcbn0pXG5leHBvcnQgY2xhc3MgRHJhZ2dhYmxlRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKVxuICBASW5wdXRCb29sZWFuKClcbiAgcHVibGljIGNlRHJhZ0Rpc2FibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpXG4gIEBJbnB1dEJvb2xlYW4oKVxuICBwdWJsaWMgY2VVc2VTcGFjZSA9IGZhbHNlO1xuICBAT3V0cHV0KClcbiAgcHVibGljIGNlT25TdGFydCA9IG5ldyBFdmVudEVtaXR0ZXI8UG9pbnRlckV2ZW50PigpO1xuICBAT3V0cHV0KClcbiAgcHVibGljIGNlT25Nb3ZlID0gbmV3IEV2ZW50RW1pdHRlcjxNb3VzZUV2ZW50PigpO1xuICBAT3V0cHV0KClcbiAgcHVibGljIGNlT25TdG9wID0gbmV3IEV2ZW50RW1pdHRlcjxQb2ludGVyRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgY2VPblNwYWNlS2V5RG93biA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgcHVibGljIHNwYWNlS2V5RG93biA9IGZhbHNlO1xuICBwcml2YXRlIHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgcHJpdmF0ZSBtb3VzZU1vdmUkID0gZnJvbUV2ZW50PFBvaW50ZXJFdmVudD4od2luZG93LCAncG9pbnRlcm1vdmUnKTtcbiAgcHJpdmF0ZSBtb3VzZVVwJCA9IGZyb21FdmVudDxQb2ludGVyRXZlbnQ+KHdpbmRvdywgJ3BvaW50ZXJ1cCcpO1xuICBwcml2YXRlIG1vdXNlRG93biQ6IE9ic2VydmFibGU8UG9pbnRlckV2ZW50PjtcbiAgcHJpdmF0ZSBtb3VzZUVudGVyJDogT2JzZXJ2YWJsZTxQb2ludGVyRXZlbnQ+O1xuICBwcml2YXRlIG1vdXNlTGVhdmUkOiBPYnNlcnZhYmxlPFBvaW50ZXJFdmVudD47XG4gIHByaXZhdGUga2V5RG93biQgPSBmcm9tRXZlbnQ8S2V5Ym9hcmRFdmVudD4oZG9jdW1lbnQsICdrZXlkb3duJyk7XG4gIHByaXZhdGUga2V5VXAkID0gZnJvbUV2ZW50PEtleWJvYXJkRXZlbnQ+KGRvY3VtZW50LCAna2V5dXAnKTtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVSZWY6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LCBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICB0aGlzLm1vdXNlRG93biQgPSBmcm9tRXZlbnQ8UG9pbnRlckV2ZW50Pih0aGlzLmVsZVJlZi5uYXRpdmVFbGVtZW50LCAncG9pbnRlcmRvd24nKS5waXBlKGZpbHRlcigoZSkgPT4gZS5idXR0b24gPT09IDApKTtcbiAgICB0aGlzLm1vdXNlRW50ZXIkID0gZnJvbUV2ZW50PFBvaW50ZXJFdmVudD4odGhpcy5lbGVSZWYubmF0aXZlRWxlbWVudCwgJ3BvaW50ZXJlbnRlcicpO1xuICAgIHRoaXMubW91c2VMZWF2ZSQgPSBmcm9tRXZlbnQ8UG9pbnRlckV2ZW50Pih0aGlzLmVsZVJlZi5uYXRpdmVFbGVtZW50LCAncG9pbnRlcmxlYXZlJyk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmxpc3RlblNwYWNlS2V5RXZlbnQoKTtcbiAgICB0aGlzLm1vdXNlRG93biRcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoKCkgPT4gIXRoaXMuY2VEcmFnRGlzYWJsZWQpLFxuICAgICAgICBmaWx0ZXIoKCkgPT4gKHRoaXMuY2VVc2VTcGFjZSA/IHRoaXMuc3BhY2VLZXlEb3duIDogdHJ1ZSkpLFxuICAgICAgICBzd2l0Y2hNYXAoKHN0YXJ0RXYpID0+IHtcbiAgICAgICAgICB0aGlzLmNlT25TdGFydC5lbWl0KHN0YXJ0RXYpO1xuICAgICAgICAgIHJldHVybiB0aGlzLm1vdXNlTW92ZSQucGlwZSh0YWtlVW50aWwodGhpcy5tb3VzZVVwJC5waXBlKG1hcCgoc3RvcEV2KSA9PiB0aGlzLmNlT25TdG9wLmVtaXQoc3RvcEV2KSkpKSk7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKChtb3ZlRXYpID0+IHRoaXMuY2VPbk1vdmUuZW1pdChtb3ZlRXYpKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBsaXN0ZW5TcGFjZUtleUV2ZW50KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLmFkZChcbiAgICAgIHRoaXMubW91c2VFbnRlciRcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgZmlsdGVyKCgpID0+ICF0aGlzLmNlRHJhZ0Rpc2FibGVkKSxcbiAgICAgICAgICBmaWx0ZXIoKCkgPT4gdGhpcy5jZVVzZVNwYWNlKSxcbiAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT5cbiAgICAgICAgICAgIHRoaXMua2V5RG93biQucGlwZShcbiAgICAgICAgICAgICAgc3dpdGNoTWFwKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFjZUtleURvd24gPSBlLmtleSA9PT0gJyAnO1xuICAgICAgICAgICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zcGFjZUtleURvd24pIHtcbiAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmtleVVwJDtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGFjZUtleURvd24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNlT25TdG9wLmVtaXQoKTtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLm1vdXNlTGVhdmUkKSxcbiAgICAgICAgICAgICAgZmluYWxpemUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3BhY2VLZXlEb3duID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5jZU9uU3RvcC5lbWl0KCk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKVxuICAgICk7XG4gIH1cbn1cbiJdfQ==