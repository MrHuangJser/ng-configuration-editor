!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/operators"),require("lodash"),require("@ngrx/component-store"),require("rxjs"),require("@angular/common"),require("ng-zorro-antd/pipes"),require("ng-zorro-antd/core/util"),require("ng-zorro-antd/tree"),require("ng-zorro-antd/dropdown"),require("ng-zorro-antd/core/transition-patch"),require("ng-zorro-antd/icon"),require("ng-zorro-antd/menu"),require("ng-zorro-antd/card"),require("@angular/cdk/drag-drop"),require("ng-zorro-antd/button"),require("@angular/forms"),require("ng-zorro-antd/form"),require("ng-zorro-antd/grid"),require("ng-zorro-antd/input-number"),require("ng-zorro-antd/input"),require("ng-zorro-antd/collapse"),require("ng-zorro-antd/switch"),require("ng-zorro-antd/select"),require("ng-zorro-antd/tag"),require("@angular/common/http"),require("@angular/platform-browser/animations"),require("@ant-design/icons-angular/icons"),require("ng-zorro-antd/divider"),require("ng-zorro-antd/tabs"),require("ng-zorro-antd/tooltip")):"function"==typeof define&&define.amd?define("angular-editor-lib",["exports","@angular/core","rxjs/operators","lodash","@ngrx/component-store","rxjs","@angular/common","ng-zorro-antd/pipes","ng-zorro-antd/core/util","ng-zorro-antd/tree","ng-zorro-antd/dropdown","ng-zorro-antd/core/transition-patch","ng-zorro-antd/icon","ng-zorro-antd/menu","ng-zorro-antd/card","@angular/cdk/drag-drop","ng-zorro-antd/button","@angular/forms","ng-zorro-antd/form","ng-zorro-antd/grid","ng-zorro-antd/input-number","ng-zorro-antd/input","ng-zorro-antd/collapse","ng-zorro-antd/switch","ng-zorro-antd/select","ng-zorro-antd/tag","@angular/common/http","@angular/platform-browser/animations","@ant-design/icons-angular/icons","ng-zorro-antd/divider","ng-zorro-antd/tabs","ng-zorro-antd/tooltip"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["angular-editor-lib"]={},e.ng.core,e.rxjs.operators,e._,e.componentStore,e.rxjs,e.ng.common,e.i3$1,e.util,e.i4,e.i3$2,e.i6,e.i7,e.i8,e.i2,e.ng.cdk.dragDrop,e.i5,e.ng.forms,e.i3$4,e.i4$1,e.i7$1,e.i8$1,e.i3$5,e.i9,e.i10,e.i8$2,e.ng.common.http,e.ng.platformBrowser.animations,e.AllIcons,e.divider,e.tabs,e.tooltip)}(this,(function(e,t,n,r,i,o,a,s,l,c,d,p,u,h,f,m,g,b,v,y,z,S,x,w,O,P,E,C,M,I,N,k){"use strict";function B(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var j=B(M),D=function(e,t){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function R(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}Object.create;function V(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function T(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(V(arguments[t]));return e}Object.create;var L=new Set([0,90,180,270,360]);function $(){return""+Date.now()+Math.round(1e12*Math.random())}var F=function(){function e(){e.shared=this}return e.prototype.isTemplateType=function(e){return e instanceof t.TemplateRef},e.prototype.isDeepEqual=function(e,t){var n=this;if(typeof e!=typeof t)return!1;switch(typeof e){case"number":case"string":case"bigint":case"boolean":case"symbol":case"undefined":case"function":return e===t;case"object":if(null===e||null===t)return e===t;if(Array.isArray(e)){if(e.length!==t.length)return!1;var r=!0;return e.forEach((function(e,i){r&&(r=n.isDeepEqual(e,t[i]))})),r}if(e instanceof Set&&t instanceof Set)return this.isDeepEqual(T(e),T(t));var i=!0;return Object.keys(e).forEach((function(r){i&&(i=!!t.hasOwnProperty(r)&&n.isDeepEqual(e[r],t[r]))})),i}},e.prototype.getNodeById=function(e,t){for(var n,r=!1,i=T(t),o=function(){var t=i.pop();t.id===e?(r=!0,n=t):t.children&&t.children.length&&i.push.apply(i,T(t.children.map((function(e){return Object.assign(Object.assign({},e),{parentNode:t})}))))};!r&&i.length;)o();return n},e.prototype.getNodeAndParentListById=function(e,t){if(!e)return[];for(var n=new Set(t.map((function(e){return e.id}))),r=!1,i=[],o=T(t);!r&&o.length;){var a=o.shift();n.has(a.id)&&(i=[]),a.id===e?(r=!0,i.unshift(a)):a.children&&a.children.length&&(i.unshift(a),o.unshift.apply(o,T(a.children)))}return i},e.prototype.getSameLayerParentByChildren=function(e,t){for(var n=this,r=!0,i=e.map((function(e){return n.getNodeAndParentListById(e,t)[1]})),o=i.pop();r&&i.length;){var a=i.pop();(null==o?void 0:o.id)===(null==a?void 0:a.id)?o=a:r=!1}return r&&o},e.prototype.getPointInLine=function(e,t,n){var r=V(n,2),i=V(r[0],2),o=i[0],a=i[1],s=V(r[1],2),l=s[0],c=s[1];switch(e){case"x":return(t-a)*(l-o)/(c-a)+o;case"y":return(t-o)*(c-a)/(l-o)+a}},e.prototype.getAbsolutePosition=function(e,t,n,r,i){if(void 0===i&&(i=0),L.has(i))return this.getAbsolutePositionSpecial(e,t,n,r,i);var o=Math.sqrt(Math.pow(n/2,2)+Math.pow(r/2,2)),a=Math.atan(r/2/(n/2)),s=Math.atan(n/2/(r/2)),l=i*Math.PI/180;return{tl:[e-Math.cos(l+a)*o,t-Math.sin(l+a)*o],tr:[e-Math.cos(l+a+2*s)*o,t-Math.sin(l+a+2*s)*o],bl:[e-Math.cos(l-a)*o,t-Math.sin(l-a)*o],br:[e-Math.cos(l-a-2*s)*o,t-Math.sin(l-a-2*s)*o]}},e.prototype.getAbsolutePositionSpecial=function(e,t,n,r,i){if(L.has(i))switch(i){case 0:case 360:return{tl:[e-n/2,t-r/2],tr:[e+n/2,t-r/2],bl:[e-n/2,t+r/2],br:[e+n/2,t+r/2]};case 90:return{tl:[e+r/2,t-n/2],tr:[e+r/2,t+n/2],bl:[e-r/2,t-n/2],br:[e-r/2,t+n/2]};case 180:return{tl:[e+n/2,t+r/2],tr:[e-n/2,t+r/2],bl:[e+n/2,t-r/2],br:[e-n/2,t-r/2]};case 270:return{tl:[e-r/2,t+n/2],tr:[e-r/2,t-n/2],bl:[e+r/2,t+n/2],br:[e+r/2,t-n/2]}}},e.prototype.getVerticalAndHorizontalPointByAbsolutePosition=function(e){var t=e.tl,n=e.bl,r=e.br,i=e.tr;return{t:[(Math.max(t[0],i[0])-Math.min(t[0],i[0]))/2,(Math.max(t[1],i[1])-Math.min(t[1],i[1]))/2],r:[(Math.max(r[0],i[0])-Math.min(r[0],i[0]))/2,(Math.max(r[1],i[1])-Math.min(r[1],i[1]))/2],b:[(Math.max(n[0],r[0])-Math.min(n[0],r[0]))/2,(Math.max(n[1],r[1])-Math.min(n[1],r[1]))/2],l:[(Math.max(t[0],n[0])-Math.min(t[0],n[0]))/2,(Math.max(t[1],n[1])-Math.min(t[1],n[1]))/2]}},e.prototype.getBoundingBox=function(e,t,n,r,i){void 0===i&&(i=0);var o=this.getAbsolutePosition(n+e/2,r+t/2,e,t,i),a=Math.min.apply(Math,T(this.getAxisListByPosition("x",[o]))),s=Math.max.apply(Math,T(this.getAxisListByPosition("x",[o]))),l=Math.min.apply(Math,T(this.getAxisListByPosition("y",[o]))),c=Math.max.apply(Math,T(this.getAxisListByPosition("y",[o])));return{left:a,top:l,width:s-a,height:c-l,bottom:c,right:s,cx:a+(s-a)/2,cy:l+(c-l)/2}},e.prototype.getAxisListByPosition=function(e,t){switch(e){case"x":return t.reduce((function(e,t){return T(e,[t.bl[0],t.br[0],t.tl[0],t.tr[0]])}),[]);case"y":return t.reduce((function(e,t){return T(e,[t.bl[1],t.br[1],t.tl[1],t.tr[1]])}),[])}},e.prototype.getOuterBoundingBox=function(e){var t=Math.min.apply(Math,T(this.getAxisListByPosition("x",e))),n=Math.max.apply(Math,T(this.getAxisListByPosition("x",e))),r=Math.min.apply(Math,T(this.getAxisListByPosition("y",e))),i=Math.max.apply(Math,T(this.getAxisListByPosition("y",e)));return{left:t,top:r,width:n-t,height:i-r,bottom:i,right:n,cx:t+(n-t)/2,cy:r+(i-r)/2}},e.prototype.sortNodeListByIndex=function(e){var t=this;return e&&r.chain(e).sortBy((function(e){return e.zIndex})).map((function(e){return Object.assign(Object.assign({},e),{children:t.sortNodeListByIndex(e.children)})})).value()},e.prototype.getVerticalLineCrossPoint=function(e,t,n){var r=V(e,2),i=r[0],o=r[1],a=V(t,2),s=a[0],l=a[1],c=V(n,2),d=c[0],p=c[1];if(i===s)return[i,p];if(o===l)return[d,o];var u=(o-l)/(i-s),h=-1/u,f=o-u*i,m=(p-h*d-f)/(u-h);return[m,u*m+f]},e.prototype.getRelativePosition=function(e){var t=e.tl,n=e.bl,r=e.br,i=e.tr,o=Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)),a=Math.sqrt(Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)),s=r[1]-t[1],l=t[0]-r[0],c=r[0]*t[1]-t[0]*r[1],d=n[1]-i[1],p=i[0]-n[0],u=n[0]*i[1]-i[0]*n[1],h=(l*u-p*c)/(s*p-d*l),f=(d*c-s*u)/(s*p-d*l);return{cx:h,cy:f,width:o,height:a,left:h-o/2,top:f-a/2,bottom:h+o/2,right:f+a/2}},e.prototype.getItemPercentPositionInGroup=function(e,t){return{tl:[(t.tl[0]-e.left)/e.width,(t.tl[1]-e.top)/e.height],tr:[(t.tr[0]-e.left)/e.width,(t.tr[1]-e.top)/e.height],bl:[(t.bl[0]-e.left)/e.width,(t.bl[1]-e.top)/e.height],br:[(t.br[0]-e.left)/e.width,(t.br[1]-e.top)/e.height]}},e.prototype.getRotate=function(e,t,n,r,i,o){var a=180*Math.acos((Math.pow(t-r,2)+Math.pow(e-n,2)+Math.pow(e-i,2)+Math.pow(t-o,2)-(Math.pow(i-n,2)+Math.pow(o-r,2)))/(2*Math.sqrt(Math.pow(t-r,2)+Math.pow(e-n,2))*Math.sqrt(Math.pow(e-i,2)+Math.pow(t-o,2))))/Math.PI;return i===n?180:i>n?a:i<n?360-a:void 0},e.prototype.getPointByVectorSum=function(e,t,n){return[e[0]+t[0]+n[0],e[1]+t[1]+n[1]]},e.prototype.getDistanceBeforeToPoint=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},e.prototype.getChildPositionBaseOnParentCoordinateSystem=function(e,t,n){var r=[e.left+e.width/2,e.top+e.height/2],i=[n.left+n.width/2+e.left,n.top+n.height/2+e.top],o=V([(i[0]-r[0])*Math.cos(t*Math.PI/180)-(i[1]-r[1])*Math.sin(t*Math.PI/180)+r[0],(i[1]-r[1])*Math.cos(t*Math.PI/180)+(i[0]-r[0])*Math.sin(t*Math.PI/180)+r[1]],2),a=o[0],s=o[1];return{left:a-n.width/2,top:s-n.height/2,bottom:a+n.width/2,right:s+n.height/2,width:n.width,height:n.height,cx:a,cy:s}},e.prototype.getChildPositionBaseOnMultipleParentCoordinataSystem=function(e,t){for(var n=Object.assign({},e);t.length;){var r=t.shift();n=this.getChildPositionBaseOnParentCoordinateSystem(r,r.rotate,e)}return n},e.prototype.getChildrenBoundingBoxBaseOnParentCoordinateSystem=function(e,t){for(var n=this,r=this.getOuterBoundingBox(e.map((function(e){return n.getAbsolutePosition(e.left+e.width/2,e.top+e.height/2,e.width,e.height,e.rotate)}))),i=Object.assign({},r);t.length;){var o=t.shift();i=this.getChildPositionBaseOnParentCoordinateSystem(o,o.rotate,i)}return i},e.prototype.getResizeBoundingBox=function(e,t){var n,r,i,o=this;if(1===e.length){var a=V(this.getNodeAndParentListById(e[0],t)),s=a[0],l=a.slice(1);r=Object.assign({},this.getChildPositionBaseOnMultipleParentCoordinataSystem(s,T(l))),i=l.reduce((function(e,t){var n;return e+(null!==(n=t.rotate)&&void 0!==n?n:0)}),null!==(n=s.rotate)&&void 0!==n?n:0)}else{var c=this.getSameLayerParentByChildren(e,t);if(!1!==c){l=this.getNodeAndParentListById(null==c?void 0:c.id,t);r=this.getChildrenBoundingBoxBaseOnParentCoordinateSystem(e.map((function(e){return o.getNodeById(e,t)})),T(l)),i=l.reduce((function(e,t){var n;return e+(null!==(n=t.rotate)&&void 0!==n?n:0)}),0)}}return Object.assign(Object.assign({},r),{rotate:i})},e}();F.ɵfac=function(e){return new(e||F)},F.ɵprov=t.ɵɵdefineInjectable({token:F,factory:F.ɵfac,providedIn:"root"});var A={nodes:[],selected:new Set,bordered:new Set,canvasBackground:{backgroundColor:"#ffffff"},canvasPosition:{left:100,top:100,scale:1},canvasSize:{width:1366,height:768},refLineState:{tx:{state:!1},bx:{state:!1},ly:{state:!1},ry:{state:!1},cx:{state:!1},cy:{state:!1}}},K=function(e){function t(t){var n=e.call(this,A)||this;return n.utils=t,n._defaultPanels=[{key:"LAYERS",title:"图层",content:xe,show:!0,x:10,y:60},{key:"WIDGET_LIST",title:"组件",content:vt,show:!1,x:50,y:60},{key:"PROPERTIES",title:"属性",content:Xe,show:!0,x:window.innerWidth-350,y:60}],n.panels=[],n.panels$=new o.BehaviorSubject(T(n._defaultPanels,n.panels)),n}return function(e,t){function n(){this.constructor=e}D(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.initialize=function(e){this.setState(e)},t.prototype._get=function(){return this.get()},t.prototype.dispatch=function(e){this.setState(e)},t.prototype.selectDifferent=function(e){var t=this;return this.select(e).pipe(n.startWith(null,e(this.get())),n.pairwise(),n.filter((function(e){var n=V(e,2),r=n[0],i=n[1];return!t.utils.isDeepEqual(r,i)})),n.map((function(e){return V(e,2)[1]})))},t.prototype.toJSON=function(){var e=this.get();return JSON.stringify({canvasPosition:e.canvasPosition,canvasSize:e.canvasSize,canvasBackground:e.canvasBackground,nodes:e.nodes,selected:e.selected,bordered:e.bordered})},t.prototype.addPanels=function(e){this.panels=T(this.panels,e),this.panels$.next(T(this._defaultPanels,this.panels))},t.prototype.getPanel=function(e){return T(this._defaultPanels,this.panels).find((function(t){return t.key===e}))},t.prototype.updatePanelPosition=function(e,t){var n=V(t,2),r=n[0],i=n[1];T(this._defaultPanels,this.panels).forEach((function(t){t.key===e&&(t.x=r,t.y=i)})),this.panels$.next(T(this._defaultPanels,this.panels))},t.prototype.togglePanelVisible=function(e){T(this._defaultPanels,this.panels).forEach((function(t){t.key===e&&(t.show=!t.show)})),this.panels$.next(T(this._defaultPanels,this.panels))},t.prototype.togglePanelCollapsed=function(e){T(this._defaultPanels,this.panels).forEach((function(t){t.key===e&&(t.collapsed=!t.collapsed)})),this.panels$.next(T(this._defaultPanels,this.panels))},t}(i.ComponentStore);function q(e,n){if(1&e&&t.ɵɵelement(0,"div",1),2&e){var r=n.$implicit,i=t.ɵɵnextContext();t.ɵɵstyleProp("left",r.left,"%")("top",r.top,"%")("width",r.width,"%")("height",r.height,"%")("transform",i.getRotate(r.rotate))}}K.ɵfac=function(e){return new(e||K)(t.ɵɵinject(F))},K.ɵprov=t.ɵɵdefineInjectable({token:K,factory:K.ɵfac});var G=function(){function e(e,t){this.store=e,this.utils=t,this.borderedNodeMap=new Map}return e.prototype.ngOnInit=function(){var e=this;this.borderedNodeList$=this.store.selectDifferent((function(e){return{bordered:e.bordered,nodes:e.nodes,canvasSize:e.canvasSize}})).pipe(n.map((function(t){var n=t.bordered,r=t.nodes,i=t.canvasSize;return n.size?e.refreshBorderedList(r,n,i):[]})))},e.prototype.getRotate=function(e){return"rotate("+e+"deg)"},e.prototype.trackByFn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e[1].id+"-"+e[1].width+"-"+e[1].height+"-"+e[1].left+"-"+e[1].top+"-"+e[1].rotate},e.prototype.refreshBorderedList=function(e,t,n){var r=this;return T(t).map((function(t){return r.utils.getNodeById(t,e)})).filter((function(e){return!!e})).map((function(t){for(var i,o=V(r.utils.getNodeAndParentListById(t.id,e)).slice(1),a=Object.assign({},t);o.length;){var s=o.shift();a=Object.assign(Object.assign(Object.assign({},a),r.utils.getChildPositionBaseOnParentCoordinateSystem(s,null!==(i=s.rotate)&&void 0!==i?i:0,a)),{rotate:a.rotate+s.rotate})}return{id:t.id,width:a.width/n.width*100,height:a.height/n.height*100,left:a.left/n.width*100,top:a.top/n.height*100,rotate:a.rotate}}))},e}();function H(e,n){if(1&e&&t.ɵɵelement(0,"ce-box-item",2),2&e){var r=n.$implicit;t.ɵɵproperty("node",r)}}function _(e,n){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,H,1,1,"ce-box-item",1),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",r.node.children)}}G.ɵfac=function(e){return new(e||G)(t.ɵɵdirectiveInject(K),t.ɵɵdirectiveInject(F))},G.ɵcmp=t.ɵɵdefineComponent({type:G,selectors:[["ce-bordered-area"],["","ceBorderedArea",""]],decls:2,vars:4,consts:[["class","box-border",3,"left","top","width","height","transform",4,"ngFor","ngForOf","ngForTrackBy"],[1,"box-border"]],template:function(e,n){1&e&&(t.ɵɵtemplate(0,q,1,10,"div",0),t.ɵɵpipe(1,"async")),2&e&&t.ɵɵproperty("ngForOf",t.ɵɵpipeBind1(1,2,n.borderedNodeList$))("ngForTrackBy",n.trackByFn)},directives:[a.NgForOf],pipes:[a.AsyncPipe],styles:["[ceBorderedArea],ce-bordered-area{bottom:0;display:block;left:0;position:absolute;right:0;top:0}[ceBorderedArea] .box-border,ce-bordered-area .box-border{border:1px solid #1890ff;box-sizing:border-box;position:absolute}"],encapsulation:2,changeDetection:0});var U=function(){function e(e,t){this.renderer=e,this.eleRef=t}return Object.defineProperty(e.prototype,"node",{get:function(){return this._node},set:function(e){this._node=e,this.generatorStyles()},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.generatorStyles()},e.prototype.generatorStyles=function(){var e;this.eleRef.nativeElement&&(this.renderer.setAttribute(this.eleRef.nativeElement,"id","box-item-"+this.node.id),this.renderer.setStyle(this.eleRef.nativeElement,"width",this.node.width+"px"),this.renderer.setStyle(this.eleRef.nativeElement,"height",this.node.height+"px"),this.renderer.setStyle(this.eleRef.nativeElement,"left",this.node.left+"px"),this.renderer.setStyle(this.eleRef.nativeElement,"top",this.node.top+"px"),this.renderer.setStyle(this.eleRef.nativeElement,"transform","translate3d(0,0,0) rotate("+(null!==(e=this.node.rotate)&&void 0!==e?e:0)+"deg)"),this.renderer.setStyle(this.eleRef.nativeElement,"border-style",this.node.borderStyle),this.renderer.setStyle(this.eleRef.nativeElement,"border-color",this.node.borderColor),this.renderer.setStyle(this.eleRef.nativeElement,"border-width",this.node.borderWidth+"px"),this.renderer.setStyle(this.eleRef.nativeElement,"z-index",this.node.zIndex),this.renderer.setStyle(this.eleRef.nativeElement,"background-image",this.node.backgroundImage),this.renderer.setStyle(this.eleRef.nativeElement,"background-position",this.node.backgroundPosition),this.renderer.setStyle(this.eleRef.nativeElement,"background-repeat",this.node.backgroundRepeat),this.renderer.setStyle(this.eleRef.nativeElement,"background-size",this.node.backgroundSize),this.renderer.setStyle(this.eleRef.nativeElement,"background-color",this.node.backgroundColor))},e}();function W(e,n){if(1&e&&(t.ɵɵelement(0,"img",1),t.ɵɵpipe(1,"nzSanitizer"),t.ɵɵpipe(2,"async")),2&e){var r=t.ɵɵnextContext();t.ɵɵproperty("src",t.ɵɵpipeBind2(1,1,t.ɵɵpipeBind1(2,4,r.backgroundImage$),"url"),t.ɵɵsanitizeUrl)}}U.ɵfac=function(e){return new(e||U)(t.ɵɵdirectiveInject(t.Renderer2),t.ɵɵdirectiveInject(t.ElementRef))},U.ɵcmp=t.ɵɵdefineComponent({type:U,selectors:[["ce-box-item"]],inputs:{node:"node"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"node",4,"ngFor","ngForOf"],[3,"node"]],template:function(e,n){1&e&&t.ɵɵtemplate(0,_,2,1,"ng-container",0),2&e&&t.ɵɵproperty("ngIf",(null==n.node?null:n.node.children)&&(null==n.node?null:n.node.children.length))},directives:[a.NgIf,a.NgForOf,U],styles:["ce-box-item{box-sizing:border-box;display:block;position:absolute}"],encapsulation:2,changeDetection:0});var Y=function(e){this.store=e,this.backgroundColor$=this.store.selectDifferent((function(e){return e.canvasBackground.backgroundColor})),this.backgroundImage$=this.store.selectDifferent((function(e){return e.canvasBackground.backgroundImage}))};Y.ɵfac=function(e){return new(e||Y)(t.ɵɵdirectiveInject(K))},Y.ɵcmp=t.ɵɵdefineComponent({type:Y,selectors:[["ce-canvas-background"],["","ceCanvasBackground",""]],decls:4,vars:7,consts:[[3,"ngIf"],["alt","",3,"src"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵpipe(1,"async"),t.ɵɵtemplate(2,W,3,6,"ng-template",0),t.ɵɵpipe(3,"async"),t.ɵɵelementEnd()),2&e&&(t.ɵɵstyleProp("background-color",t.ɵɵpipeBind1(1,3,n.backgroundColor$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",t.ɵɵpipeBind1(3,5,n.backgroundImage$)))},directives:[a.NgIf],pipes:[a.AsyncPipe,s.NzSanitizerPipe],styles:["ce-canvas-background{display:block;left:0;overflow:hidden;position:absolute;top:0}ce-canvas-background,ce-canvas-background>div{height:100%;width:100%}ce-canvas-background img{height:100%;left:50%;position:absolute;top:50%;transform:translate3d(-50%,-50%,0);width:100%}"],encapsulation:2,changeDetection:0});var Q=function(){function e(e){var t=this;this.store=e;var r=this.store.selectDifferent((function(e){return e.canvasPosition.scale}));this.childDPath$=r.pipe(n.map((function(e){return t.getPath(10,e)}))),this.parentDPath$=r.pipe(n.map((function(e){return t.getPath(50,e)}))),this.childWidth$=r.pipe(n.map((function(e){return 10*e}))),this.parentWidth$=r.pipe(n.map((function(e){return 50*e})))}return e.prototype.getPath=function(e,t){return"M "+(e*t||0)+" 0 L 0 0 0 "+(e*t||0)},e}();function X(){return function(e){return Object.assign(Object.assign({},e),{selected:new Set([])})}}function Z(e){return function(t){return Object.assign(Object.assign({},t),{selected:new Set(T(e))})}}function J(){return function(e){return Object.assign(Object.assign({},e),{bordered:new Set([])})}}function ee(e){return function(t){return Object.assign(Object.assign({},t),{bordered:new Set(T(t.bordered,e))})}}function te(e){return function(t){return Object.assign(Object.assign({},t),{bordered:new Set(T(t.bordered).filter((function(t){return!e.includes(t)})))})}}function ne(e){return function(t){return Object.assign(Object.assign({},t),{bordered:new Set(T(e))})}}function re(e){return function(t){return Object.assign(Object.assign({},t),{canvasPosition:Object.assign(Object.assign({},t.canvasPosition),e)})}}function ie(e){return function(t){return Object.assign(Object.assign({},t),{nodes:t.nodes.map((function(t){return Object.assign(Object.assign({},t),e.find((function(e){return e.id===t.id})))}))})}}function oe(e){return function(t){for(var n,r,i=!0,o=T(e.keys());i&&o.length;){var a=o.pop(),s=F.shared.getNodeById(a,t.nodes);i=(null==r?void 0:r.id)===(null===(n=s.parentNode)||void 0===n?void 0:n.id),r=s.parentNode}return i?r?t:Object.assign(Object.assign({},t),{nodes:t.nodes.map((function(t){var n=Object.assign(Object.assign({},t),e.get(t.id));return t.children&&t.children.length?Object.assign(Object.assign({},n),{children:le(n.children,Object.assign({},t),Object.assign({},n))}):n}))}):t}}function ae(e){return function(t){if(!1===F.shared.getSameLayerParentByChildren(e,t.nodes))return t;var n=new Map;e.forEach((function(e){var r=t.nodes.find((function(t){return t.id===e}));r&&n.set(e,r)}));var r=F.shared.getOuterBoundingBox(e.filter((function(e){return n.has(e)})).map((function(e){var t=n.get(e);return F.shared.getAbsolutePosition(t.left+t.width/2,t.top+t.height/2,t.width,t.height,t.rotate)}))),i=Object.assign(Object.assign({id:$(),name:"Group"},r),{rotate:0,zIndex:Math.max.apply(Math,T(t.nodes.filter((function(e){return!n.has(e.id)})).map((function(e){return e.zIndex}))))+1,children:e.filter((function(e){return n.has(e)})).map((function(e){var t=n.get(e),i=F.shared.getAbsolutePosition(t.left+t.width/2,t.top+t.height/2,t.width,t.height,t.rotate),o=i.bl,a=i.br,s=i.tl,l=i.tr;return Object.assign(Object.assign({},t),F.shared.getRelativePosition({bl:[o[0]-r.left,o[1]-r.top],br:[a[0]-r.left,a[1]-r.top],tl:[s[0]-r.left,s[1]-r.top],tr:[l[0]-r.left,l[1]-r.top]}))}))});return Object.assign(Object.assign({},t),{nodes:T(t.nodes.filter((function(e){return!n.has(e.id)})),[i])})}}function se(e){return function(t){var n=V(F.shared.getNodeAndParentListById(e,r.cloneDeep(t.nodes))),i=n[0],o=n.slice(1),a=i.children.map((function(e){var t,n;return Object.assign(Object.assign(Object.assign({},e),F.shared.getChildPositionBaseOnParentCoordinateSystem(i,i.rotate,e)),{rotate:(null!==(t=e.rotate)&&void 0!==t?t:0)+(null!==(n=i.rotate)&&void 0!==n?n:0)})}));if(o.length){var s=o.shift();for(s.children=T(s.children.filter((function(e){return e.id!==i.id})),a);o.length;){var l=o.shift();l.children=l.children.map((function(e){return e.id===s.id?s:e})),s=l}return Object.assign(Object.assign({},t),{nodes:T(t.nodes.filter((function(e){return e.id!==s.id})),[s])})}return Object.assign(Object.assign({},t),{nodes:T(t.nodes.filter((function(e){return e.id!==i.id})),a)})}}function le(e,t,n){var r=n.width,i=n.height;return e.map((function(e){var n=F.shared.getAbsolutePosition(e.left+e.width/2,e.top+e.height/2,e.width,e.height,e.rotate),o=F.shared.getItemPercentPositionInGroup(Object.assign(Object.assign({},t),{left:0,top:0}),n),a=o.tl,s=o.tr,l=o.bl,c=o.br,d=F.shared.getRelativePosition({tl:[a[0]*r,a[1]*i],tr:[s[0]*r,s[1]*i],bl:[l[0]*r,l[1]*i],br:[c[0]*r,c[1]*i]});return e.children&&e.children.length?Object.assign(Object.assign(Object.assign({},e),d),{children:le(e.children,Object.assign({},e),Object.assign({},d))}):Object.assign(Object.assign({},e),d)}))}function ce(){return function(e){return Object.assign(Object.assign({},e),{refLineState:A.refLineState})}}Q.ɵfac=function(e){return new(e||Q)(t.ɵɵdirectiveInject(K))},Q.ɵcmp=t.ɵɵdefineComponent({type:Q,selectors:[["ce-canvas-grid"]],decls:16,vars:24,consts:[["data-html2canvas-ignore","","width","100%","height","100%",1,"grid"],["id","smallGrid","patternUnits","userSpaceOnUse"],["fill","none","stroke","rgba(207, 207, 207, 0.8)","stroke-width","1"],["id","grid","patternUnits","userSpaceOnUse"],["fill","url(#smallGrid)"],["fill","none","stroke","rgba(186, 186, 186, 1)","stroke-width","1"],["width","100%","height","100%","fill","url(#grid)"]],template:function(e,n){1&e&&(t.ɵɵnamespaceSVG(),t.ɵɵelementStart(0,"svg",0),t.ɵɵelementStart(1,"defs"),t.ɵɵelementStart(2,"pattern",1),t.ɵɵpipe(3,"async"),t.ɵɵpipe(4,"async"),t.ɵɵelement(5,"path",2),t.ɵɵpipe(6,"async"),t.ɵɵelementEnd(),t.ɵɵelementStart(7,"pattern",3),t.ɵɵpipe(8,"async"),t.ɵɵpipe(9,"async"),t.ɵɵelement(10,"rect",4),t.ɵɵpipe(11,"async"),t.ɵɵpipe(12,"async"),t.ɵɵelement(13,"path",5),t.ɵɵpipe(14,"async"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelement(15,"rect",6),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(2),t.ɵɵattribute("width",t.ɵɵpipeBind1(3,8,n.childWidth$))("height",t.ɵɵpipeBind1(4,10,n.childWidth$)),t.ɵɵadvance(3),t.ɵɵattribute("d",t.ɵɵpipeBind1(6,12,n.childDPath$)),t.ɵɵadvance(2),t.ɵɵattribute("width",t.ɵɵpipeBind1(8,14,n.parentWidth$))("height",t.ɵɵpipeBind1(9,16,n.parentWidth$)),t.ɵɵadvance(3),t.ɵɵattribute("width",t.ɵɵpipeBind1(11,18,n.parentWidth$))("height",t.ɵɵpipeBind1(12,20,n.parentWidth$)),t.ɵɵadvance(3),t.ɵɵattribute("d",t.ɵɵpipeBind1(14,22,n.parentDPath$)))},pipes:[a.AsyncPipe],styles:["ce-canvas-grid{display:block;height:100%;left:0;position:absolute;top:0;width:100%}ce-canvas-grid .grid{border-bottom:1px solid #cfcfcf;border-right:1px solid #cfcfcf;left:0;position:absolute;top:0;z-index:0}"],encapsulation:2,changeDetection:0});var de=function(){function e(e,r){this.eleRef=e,this.cdr=r,this.ceDragDisabled=!1,this.ceUseSpace=!1,this.ceOnStart=new t.EventEmitter,this.ceOnMove=new t.EventEmitter,this.ceOnStop=new t.EventEmitter,this.ceOnSpaceKeyDown=new t.EventEmitter,this.spaceKeyDown=!1,this.subscription=new o.Subscription,this.mouseMove$=o.fromEvent(window,"pointermove"),this.mouseUp$=o.fromEvent(window,"pointerup"),this.keyDown$=o.fromEvent(document,"keydown"),this.keyUp$=o.fromEvent(document,"keyup"),this.mouseDown$=o.fromEvent(this.eleRef.nativeElement,"pointerdown").pipe(n.filter((function(e){return 0===e.button}))),this.mouseEnter$=o.fromEvent(this.eleRef.nativeElement,"pointerenter"),this.mouseLeave$=o.fromEvent(this.eleRef.nativeElement,"pointerleave")}return e.prototype.ngOnInit=function(){var e=this;this.listenSpaceKeyEvent(),this.mouseDown$.pipe(n.filter((function(){return!e.ceDragDisabled})),n.filter((function(){return!e.ceUseSpace||e.spaceKeyDown})),n.switchMap((function(t){return e.ceOnStart.emit(t),e.mouseMove$.pipe(n.takeUntil(e.mouseUp$.pipe(n.map((function(t){return e.ceOnStop.emit(t)})))))}))).subscribe((function(t){return e.ceOnMove.emit(t)}))},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.listenSpaceKeyEvent=function(){var e=this;this.subscription.add(this.mouseEnter$.pipe(n.filter((function(){return!e.ceDragDisabled})),n.filter((function(){return e.ceUseSpace})),n.switchMap((function(){return e.keyDown$.pipe(n.switchMap((function(t){return e.spaceKeyDown=" "===t.key,e.cdr.detectChanges(),e.spaceKeyDown&&(t.preventDefault(),t.stopPropagation()),e.keyUp$})),n.map((function(){e.spaceKeyDown=!1,e.ceOnStop.emit()})),n.takeUntil(e.mouseLeave$),n.finalize((function(){e.spaceKeyDown=!1,e.ceOnStop.emit()})))}))).subscribe())},e}();function pe(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"ce-box-item",1),t.ɵɵlistener("ceOnStart",(function(e){t.ɵɵrestoreView(r);var i=n.$implicit;return t.ɵɵnextContext().moveStart(e,i)}))("ceOnMove",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().moving(e)}))("ceOnStop",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().moveEnd()}))("pointerenter",(function(){t.ɵɵrestoreView(r);var e=n.$implicit;return t.ɵɵnextContext().showBorder(e.id)}))("pointerleave",(function(){t.ɵɵrestoreView(r);var e=n.$implicit;return t.ɵɵnextContext().removeBorder(e.id)})),t.ɵɵelementEnd()}if(2&e){var i=n.$implicit;t.ɵɵproperty("ceDragDisabled",null==i?null:i.locked)("node",i)}}de.ɵfac=function(e){return new(e||de)(t.ɵɵdirectiveInject(t.ElementRef),t.ɵɵdirectiveInject(t.ChangeDetectorRef))},de.ɵdir=t.ɵɵdefineDirective({type:de,selectors:[["","ceDraggable",""]],inputs:{ceDragDisabled:"ceDragDisabled",ceUseSpace:"ceUseSpace"},outputs:{ceOnStart:"ceOnStart",ceOnMove:"ceOnMove",ceOnStop:"ceOnStop",ceOnSpaceKeyDown:"ceOnSpaceKeyDown"},exportAs:["ceDraggable"]}),R([l.InputBoolean()],de.prototype,"ceDragDisabled",void 0),R([l.InputBoolean()],de.prototype,"ceUseSpace",void 0);var ue={tx:[{baseKey:"top",referKey:"top",baseValue:function(e,t){return{key:"top",value:t.top}}},{baseKey:"top",referKey:"cy",baseValue:function(e,t){return{key:"top",value:t.cy}}},{baseKey:"top",referKey:"bottom",baseValue:function(e,t){return{key:"top",value:t.bottom}}}],bx:[{baseKey:"bottom",referKey:"top",baseValue:function(e,t){return{key:"top",value:t.top-e.height}}},{baseKey:"bottom",referKey:"cy",baseValue:function(e,t){return{key:"top",value:t.cy-e.height}}},{baseKey:"bottom",referKey:"bottom",baseValue:function(e,t){return{key:"top",value:t.bottom-e.height}}}],ly:[{baseKey:"left",referKey:"left",baseValue:function(e,t){return{key:"left",value:t.left}}},{baseKey:"left",referKey:"cx",baseValue:function(e,t){return{key:"left",value:t.cx}}},{baseKey:"left",referKey:"right",baseValue:function(e,t){return{key:"left",value:t.right}}}],ry:[{baseKey:"right",referKey:"left",baseValue:function(e,t){return{key:"left",value:t.left-e.width}}},{baseKey:"right",referKey:"cx",baseValue:function(e,t){return{key:"left",value:t.cx-e.width}}},{baseKey:"right",referKey:"right",baseValue:function(e,t){return{key:"left",value:t.right-e.width}}}],cx:[{baseKey:"cy",referKey:"top",baseValue:function(e,t){return{key:"top",value:t.top-e.height/2}}},{baseKey:"cy",referKey:"cy",baseValue:function(e,t){return{key:"top",value:t.cy-e.height/2}}},{baseKey:"cy",referKey:"bottom",baseValue:function(e,t){return{key:"top",value:t.bottom-e.height/2}}}],cy:[{baseKey:"cx",referKey:"left",baseValue:function(e,t){return{key:"left",value:t.left-e.width/2}}},{baseKey:"cx",referKey:"cx",baseValue:function(e,t){return{key:"left",value:t.cx-e.width/2}}},{baseKey:"cx",referKey:"right",baseValue:function(e,t){return{key:"left",value:t.right-e.width/2}}}]},he=function(){function e(e,t){var n=this;this.store=e,this.utils=t,this.pointerSnapshot=null,this.nodesSnapshot=new Map,this.gap=5,this.nodes$=this.store.selectDifferent((function(e){return e.nodes})),this.store.select((function(e){return e.nodes})).subscribe((function(e){return n.nodes=e})),this.store.select((function(e){return e.selected})).subscribe((function(e){return n.selected=e})),this.store.select((function(e){return e.canvasPosition})).subscribe((function(e){return n.canvasPosition=e}))}return e.prototype.nodeListTrackByFn=function(e,t){return t.id},e.prototype.moveStart=function(e,t){var n=this;e.preventDefault(),e.stopPropagation(),this.nodesSnapshot.clear(),this.pointerSnapshot=[e.clientX,e.clientY];var r,i=T(this.selected);this.selected.has(t.id)||(this.store.dispatch(J()),this.store.dispatch(X()),this.store.dispatch((r=[t.id],function(e){return Object.assign(Object.assign({},e),{selected:new Set(T(e.selected,r))})})),i=[t.id]),this.outerBoxSnapshot=this.utils.getOuterBoundingBox(i.map((function(e){return n.utils.getNodeById(e,n.nodes)})).map((function(e){return n.utils.getAbsolutePosition(e.left+e.width/2,e.top+e.height/2,e.width,e.height,e.rotate)}))),this.unselectedNodes=this.nodes.filter((function(e){return!i.includes(e.id)})),i.forEach((function(e){var t=n.nodes.find((function(t){return t.id===e}));n.nodesSnapshot.set(t.id,Object.assign(Object.assign({},t),{cxPercent:(t.left+t.width/2-n.outerBoxSnapshot.left)/n.outerBoxSnapshot.width,cyPercent:(t.top+t.height/2-n.outerBoxSnapshot.top)/n.outerBoxSnapshot.height}))}))},e.prototype.moving=function(e){var t,n=this;if(this.pointerSnapshot){this.store.dispatch(ce());var r=this.canvasPosition.scale,i=V(this.pointerSnapshot,2),o=i[0],a=i[1],s=V([(e.clientX-o)/r,(e.clientY-a)/r],2),l=s[0],c=s[1],d=Object.assign(Object.assign({},this.outerBoxSnapshot),{left:this.outerBoxSnapshot.left+l,top:this.outerBoxSnapshot.top+c,right:this.outerBoxSnapshot.right+l,bottom:this.outerBoxSnapshot.bottom+c,cx:this.outerBoxSnapshot.cx+l,cy:this.outerBoxSnapshot.cy+c}),p={bx:null,tx:null,ly:null,ry:null,cx:null,cy:null};this.unselectedNodes.forEach((function(e){var t=n.utils.getBoundingBox(e.width,e.height,e.left,e.top,e.rotate);["tx","bx","ly","ry","cx","cy"].forEach((function(e){var i=function(e,t,n,r){return ue[e].map((function(e){var i=e.baseKey,o=e.referKey,a=e.baseValue;return{state:Math.abs(t[i]-n[o])<r,position:n[o],base:a(t,n)}})).find((function(e){return e.state}))}(e,d,t,n.gap/r);if(i){var o=i.state,a=i.position,s=i.base;o&&(p[e]={state:o,position:a},d[s.key]=s.value)}}))}));var u=[];this.nodesSnapshot.forEach((function(e){var t=e.cxPercent,n=e.cyPercent,r=e.width,i=e.height,o=(e.nodeRect,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["cxPercent","cyPercent","width","height","nodeRect"]));u.push(Object.assign(Object.assign({},o),{width:r,height:i,left:t*d.width+d.left-r/2,top:n*d.height+d.top-i/2}))})),this.store.dispatch((t=p,function(e){return Object.assign(Object.assign({},e),{refLineState:Object.assign(Object.assign({},e.refLineState),t)})})),this.store.dispatch(ie(u))}},e.prototype.moveEnd=function(){this.pointerSnapshot=null,this.store.dispatch(ce()),this.nodesSnapshot.clear()},e.prototype.showBorder=function(e){this.store.dispatch(ee([e]))},e.prototype.removeBorder=function(e){this.selected.has(e)||this.store.dispatch(te([e]))},e}();he.ɵfac=function(e){return new(e||he)(t.ɵɵdirectiveInject(K),t.ɵɵdirectiveInject(F))},he.ɵcmp=t.ɵɵdefineComponent({type:he,selectors:[["ce-canvas"]],decls:2,vars:4,consts:[["ceDraggable","",3,"ceDragDisabled","node","ceOnStart","ceOnMove","ceOnStop","pointerenter","pointerleave",4,"ngFor","ngForOf","ngForTrackBy"],["ceDraggable","",3,"ceDragDisabled","node","ceOnStart","ceOnMove","ceOnStop","pointerenter","pointerleave"]],template:function(e,n){1&e&&(t.ɵɵtemplate(0,pe,1,2,"ce-box-item",0),t.ɵɵpipe(1,"async")),2&e&&t.ɵɵproperty("ngForOf",t.ɵɵpipeBind1(1,2,n.nodes$))("ngForTrackBy",n.nodeListTrackByFn)},directives:[a.NgForOf,U,de],pipes:[a.AsyncPipe],styles:["ce-canvas{bottom:0;left:0;position:absolute;right:0;top:0}"],encapsulation:2,changeDetection:0});var fe=["layerTree"];function me(e,n){if(1&e&&t.ɵɵelement(0,"i",5),2&e){var r=t.ɵɵnextContext().$implicit;t.ɵɵproperty("nzType",r.isExpanded?"folder-open":"folder")}}function ge(e,n){if(1&e&&t.ɵɵtemplate(0,me,1,1,"i",4),2&e){var r=n.$implicit;t.ɵɵproperty("ngIf",!r.isLeaf)}}function be(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"li",10),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=t.ɵɵnextContext(2),n=t.ɵɵreference(1);return e.toggleNodesLockState(n.nzSelectedKeys,!0)})),t.ɵɵelement(1,"i",12),t.ɵɵelementStart(2,"span"),t.ɵɵtext(3,"锁定"),t.ɵɵelementEnd(),t.ɵɵelementEnd()}}function ve(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"li",10),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=t.ɵɵnextContext(2),n=t.ɵɵreference(1);return e.toggleNodesLockState(n.nzSelectedKeys,!1)})),t.ɵɵelement(1,"i",13),t.ɵɵelementStart(2,"span"),t.ɵɵtext(3,"解锁"),t.ɵɵelementEnd(),t.ɵɵelementEnd()}}function ye(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"li",10),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=t.ɵɵnextContext(2),n=t.ɵɵreference(1);return e.group(n.nzSelectedKeys)})),t.ɵɵelement(1,"i",14),t.ɵɵelementStart(2,"span"),t.ɵɵtext(3,"组合"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"span",15),t.ɵɵtext(5," ctrl+shift+G "),t.ɵɵelementEnd(),t.ɵɵelementEnd()}}function ze(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"li",10),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=t.ɵɵnextContext().origin;return t.ɵɵnextContext().breakNode(e.id)})),t.ɵɵelement(1,"i",16),t.ɵɵelementStart(2,"span"),t.ɵɵtext(3,"打散"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"span",15),t.ɵɵtext(5," ctrl+shift+B "),t.ɵɵelementEnd(),t.ɵɵelementEnd()}}function Se(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",6),t.ɵɵlistener("contextmenu",(function(e){t.ɵɵrestoreView(r);var i=n.origin,o=t.ɵɵreference(4);return t.ɵɵnextContext().contextMenu(e,o,i)}))("pointerenter",(function(){t.ɵɵrestoreView(r);var e=n.origin;return t.ɵɵnextContext().showBordered(e.id)}))("pointerleave",(function(){t.ɵɵrestoreView(r);var e=n.origin;return t.ɵɵnextContext().clearBordered(e.id)})),t.ɵɵelementStart(1,"span"),t.ɵɵtext(2),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"nz-dropdown-menu",null,7),t.ɵɵelementStart(5,"ul",8),t.ɵɵtemplate(6,be,4,0,"li",9),t.ɵɵtemplate(7,ve,4,0,"li",9),t.ɵɵelementStart(8,"li",10),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=t.ɵɵnextContext(),n=t.ɵɵreference(1);return e.deleteNodes(n.nzSelectedKeys)})),t.ɵɵelement(9,"i",11),t.ɵɵelementStart(10,"span"),t.ɵɵtext(11,"删除"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(12,ye,6,0,"li",9),t.ɵɵpipe(13,"async"),t.ɵɵtemplate(14,ze,6,0,"li",9),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=n.origin,o=t.ɵɵnextContext();t.ɵɵclassProp("locked",i.locked),t.ɵɵadvance(2),t.ɵɵtextInterpolate(i.title),t.ɵɵadvance(4),t.ɵɵproperty("ngIf",!i.locked),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.locked),t.ɵɵadvance(5),t.ɵɵproperty("ngIf",t.ɵɵpipeBind1(13,7,o.groupStatus$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",1===o.selected.size&&i.children&&i.children.length)}}var xe=function(){function e(e,t,r,i){var o=this;this.eleRef=e,this.store=t,this.utils=r,this.contextMenuSrv=i,this.treeNodes$=this.store.selectDifferent((function(e){return e.nodes})).pipe(n.map((function(e){return o.transferNodesToNzNodes(o.utils.sortNodeListByIndex(e))}))),this.selectedKeys$=this.store.selectDifferent((function(e){return e.selected})).pipe(n.map((function(e){return T(e)}))),this.groupStatus$=this.store.selectDifferent((function(e){return e.selected})).pipe(n.filter((function(){return!!o.layerTree})),n.map((function(e){return e.size>1&&!!T(e).find((function(e){var t,n=null===(t=o.layerTree)||void 0===t?void 0:t.getSelectedNodeList().find((function(t){return t.key===e}));return n&&n.parentNode}))}))),this.store.selectDifferent((function(e){return e.selected})).subscribe((function(e){o.selected=e}))}return e.prototype.clearBordered=function(e){this.selected.has(e)||this.store.dispatch(te([e]))},e.prototype.showBordered=function(e){this.store.dispatch(ee([e]))},e.prototype.layerTrackByFn=function(e,t){return"box-item-"+t.id+"-"+t.zIndex},e.prototype.transferNodesToNzNodes=function(e){var t=this;return e.map((function(e){var n;return Object.assign(Object.assign({},e),{children:e.children&&t.transferNodesToNzNodes(e.children),title:e.name,key:e.id,isLeaf:!(null===(n=e.children)||void 0===n?void 0:n.length)})}))},e.prototype.contextMenu=function(e,t,n){this.selected.has(n.key)||this.store.dispatch(Z([n.key])),this.contextMenuSrv.create(e,t)},e.prototype.getParentKey=function(e){var t;return null!==(t=null==e?void 0:e.key)&&void 0!==t?t:"root"},e.prototype.multipleSelected=function(e){var t=this;this.parentKey||(this.parentKey=this.getParentKey(e.node.parentNode));var n=e.selectedKeys.filter((function(e){return t.getParentKey(e.parentNode)===t.parentKey})).map((function(e){return e.key}));this.store.dispatch(Z(n)),this.store.dispatch(ne(n))},e.prototype.clickNode=function(e){e.node&&(/Win|Linux/.test(navigator.platform)&&(e.event.ctrlKey?this.multipleSelected(e):(this.parentKey=this.getParentKey(e.node.parentNode),this.store.dispatch(Z([e.node.key])),this.store.dispatch(ne([e.node.key])))),/Mac/.test(navigator.platform)&&(e.event.metaKey?this.multipleSelected(e):(this.parentKey=this.getParentKey(e.node.parentNode),this.store.dispatch(Z([e.node.key])),this.store.dispatch(ne([e.node.key])))))},e.prototype.group=function(e){this.store.dispatch(ae(e))},e.prototype.breakNode=function(e){this.store.dispatch(X()),this.store.dispatch(J()),this.store.dispatch(se(e))},e.prototype.deleteNodes=function(e){this.store.dispatch(X()),this.store.dispatch(J()),this.store.dispatch(function(e){return function(t){var n=F.shared.getSameLayerParentByChildren(e,t.nodes);if(!1===n)return Object.assign({},t);if(void 0===n)return Object.assign(Object.assign({},t),{nodes:t.nodes.filter((function(t){return!e.includes(t.id)}))});for(var i,o,a=n.id,s=F.shared.getNodeAndParentListById(n.id,r.cloneDeep(t.nodes));s.length;){var l=void 0;if(l=(n=s.shift()).id===a?n.children.filter((function(t){return!e.includes(t.id)})):n.children.filter((function(e){return e.id===o?i:e})).filter((function(e){return!!e})),o=n.id,l.length>1){var c=F.shared.getOuterBoundingBox(l.map((function(e){return Object.assign({rotate:e.rotate},F.shared.getChildPositionBaseOnParentCoordinateSystem(n,n.rotate,e))})).map((function(e){return F.shared.getAbsolutePosition(e.cx,e.cy,e.width,e.height,e.rotate)})));n.width=c.width,n.height=c.height,n.left=c.left,n.top=c.top,n.children=l}else 1===l.length?(c=F.shared.getChildPositionBaseOnParentCoordinateSystem(n,n.rotate,l[0]),n=Object.assign(Object.assign({},l[0]),c)):0===l.length&&(n=null);i=n}return Object.assign(Object.assign({},t),{nodes:t.nodes.map((function(e){return e.id===o?n:e})).filter((function(e){return!!e}))})}}(e))},e.prototype.toggleNodesLockState=function(e,t){t?this.store.dispatch(function(e){return function(t){return Object.assign(Object.assign({},t),{nodes:t.nodes.map((function(t){return e.includes(t.id)?Object.assign(Object.assign({},t),{locked:!0}):t}))})}}(e)):this.store.dispatch(function(e){return function(t){return Object.assign(Object.assign({},t),{nodes:t.nodes.map((function(t){return e.includes(t.id)?Object.assign(Object.assign({},t),{locked:!1}):t}))})}}(e))},e}();function we(e,n){if(1&e&&(t.ɵɵelementStart(0,"div",4),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var r=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵtextInterpolate(null==r.panel?null:r.panel.title)}}function Oe(e,n){1&e&&t.ɵɵelementContainer(0)}function Pe(e,n){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,Oe,1,0,"ng-container",5),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("ngTemplateOutlet",r.panel.content)}}function Ee(e,n){1&e&&t.ɵɵelementContainer(0)}function Ce(e,n){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,Ee,1,0,"ng-container",6),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("ngComponentOutlet",r.panel.content)}}function Me(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"button",7),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().toggleCollapsed()})),t.ɵɵelement(1,"i",8),t.ɵɵelementEnd(),t.ɵɵelementStart(2,"button",9),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().close()})),t.ɵɵelement(3,"i",10),t.ɵɵelementEnd()}}xe.ɵfac=function(e){return new(e||xe)(t.ɵɵdirectiveInject(t.ElementRef),t.ɵɵdirectiveInject(K),t.ɵɵdirectiveInject(F),t.ɵɵdirectiveInject(d.NzContextMenuService))},xe.ɵcmp=t.ɵɵdefineComponent({type:xe,selectors:[["ce-layer-tree"]],viewQuery:function(e,n){if(1&e&&t.ɵɵviewQuery(fe,!0,c.NzTreeComponent),2&e){var r;t.ɵɵqueryRefresh(r=t.ɵɵloadQuery())&&(n.layerTree=r.first)}},exportAs:["ceLayerTree"],decls:8,vars:8,consts:[["nzBlockNode","","nzMultiple","",3,"nzData","nzSelectedKeys","nzTreeTemplate","nzExpandedIcon","nzClick"],["layerTree",""],["multiExpandedIconTpl",""],["nzTreeTemplate",""],["nz-icon","","class","ant-tree-switcher-line-icon",3,"nzType",4,"ngIf"],["nz-icon","",1,"ant-tree-switcher-line-icon",3,"nzType"],[1,"layer",3,"contextmenu","pointerenter","pointerleave"],["menu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","","class","action-item",3,"click",4,"ngIf"],["nz-menu-item","",1,"action-item",3,"click"],["nz-icon","","nzType","delete"],["nz-icon","","nzType","lock"],["nz-icon","","nzType","unlock"],["nz-icon","","nzIconfont","icon-group"],[1,"shortcuts"],["nz-icon","","nzIconfont","icon-break"]],template:function(e,n){if(1&e&&(t.ɵɵelementStart(0,"nz-tree",0,1),t.ɵɵlistener("nzClick",(function(e){return n.clickNode(e)})),t.ɵɵpipe(2,"async"),t.ɵɵpipe(3,"async"),t.ɵɵtemplate(4,ge,1,1,"ng-template",null,2,t.ɵɵtemplateRefExtractor),t.ɵɵtemplate(6,Se,15,9,"ng-template",null,3,t.ɵɵtemplateRefExtractor),t.ɵɵelementEnd()),2&e){var r=t.ɵɵreference(5),i=t.ɵɵreference(7);t.ɵɵproperty("nzData",t.ɵɵpipeBind1(2,4,n.treeNodes$))("nzSelectedKeys",t.ɵɵpipeBind1(3,6,n.selectedKeys$))("nzTreeTemplate",i)("nzExpandedIcon",r)}},directives:[c.NzTreeComponent,a.NgIf,p.ɵNzTransitionPatchDirective,u.NzIconDirective,d.NzDropdownMenuComponent,h.NzMenuDirective,h.NzMenuItemDirective],pipes:[a.AsyncPipe],styles:["ce-layer-tree{display:block;height:100%;margin:0 -12px 0 0;overflow:auto;position:relative}ce-layer-tree ::-webkit-scrollbar{position:absolute;right:0}ce-layer-tree .layer{align-items:center;display:flex}ce-layer-tree .layer.locked{color:rgba(0,0,0,.45)}.action-item{align-items:center;display:flex;justify-content:flex-start;min-width:200px}.action-item .shortcuts{color:rgba(0,0,0,.45);margin-left:auto}"],encapsulation:2,changeDetection:0});var Ie=function(){function e(e,t){this.utils=e,this.store=t}return Object.defineProperty(e.prototype,"panel",{get:function(){return this._panel},set:function(e){this._panel=e},enumerable:!1,configurable:!0}),e.prototype.updatePosition=function(e){this.store.updatePanelPosition(this.panel.key,[this.panel.x+e.distance.x,this.panel.y+e.distance.y])},e.prototype.toggleCollapsed=function(){this.store.togglePanelCollapsed(this.panel.key)},e.prototype.close=function(){this.store.togglePanelVisible(this.panel.key)},e}();function Ne(e,n){if(1&e&&(t.ɵɵelement(0,"img",20),t.ɵɵpipe(1,"nzSanitizer")),2&e){var r=t.ɵɵnextContext();t.ɵɵstyleProp("max-width",100,"%"),t.ɵɵproperty("src",t.ɵɵpipeBind2(1,3,r.canvasBackgroundFormGroup.controls.backgroundImage.value,"url"),t.ɵɵsanitizeUrl)}}Ie.ɵfac=function(e){return new(e||Ie)(t.ɵɵdirectiveInject(F),t.ɵɵdirectiveInject(K))},Ie.ɵcmp=t.ɵɵdefineComponent({type:Ie,selectors:[["ce-panel"],["","cePanel",""]],inputs:{panel:"panel"},decls:7,vars:7,consts:[["nzSize","small","cdkDrag","",3,"nzTitle","nzExtra","cdkDragFreeDragPosition","cdkDragEnded"],["cardTitle",""],[4,"ngIf"],["cardExtra",""],["cdkDragHandle","",1,"d-flex","align-items-center"],[4,"ngTemplateOutlet"],[4,"ngComponentOutlet"],["nz-button","","nzSize","small","nzType","link",1,"collapse-icon",3,"click"],["nz-icon","","nzType","caret-down"],["nz-button","","nzSize","small","nzType","link",3,"click"],["nz-icon","","nzType","close"]],template:function(e,n){if(1&e&&(t.ɵɵelementStart(0,"nz-card",0),t.ɵɵlistener("cdkDragEnded",(function(e){return n.updatePosition(e)})),t.ɵɵtemplate(1,we,2,1,"ng-template",null,1,t.ɵɵtemplateRefExtractor),t.ɵɵtemplate(3,Pe,2,1,"ng-container",2),t.ɵɵtemplate(4,Ce,2,1,"ng-container",2),t.ɵɵelementEnd(),t.ɵɵtemplate(5,Me,4,0,"ng-template",null,3,t.ɵɵtemplateRefExtractor)),2&e){var r=t.ɵɵreference(2),i=t.ɵɵreference(6);t.ɵɵclassProp("collapsed",null==n.panel?null:n.panel.collapsed),t.ɵɵproperty("nzTitle",r)("nzExtra",i)("cdkDragFreeDragPosition",n.panel),t.ɵɵadvance(3),t.ɵɵproperty("ngIf",n.utils.isTemplateType(n.panel.content)),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",!n.utils.isTemplateType(n.panel.content))}},directives:[f.NzCardComponent,m.CdkDrag,a.NgIf,m.CdkDragHandle,a.NgTemplateOutlet,a.NgComponentOutlet,g.NzButtonComponent,p.ɵNzTransitionPatchDirective,u.NzIconDirective],styles:["[cePanel],ce-panel{display:block;pointer-events:none;position:absolute;width:300px}[cePanel] *,ce-panel *{pointer-events:auto}[cePanel]>nz-card.collapsed .ant-card-body,ce-panel>nz-card.collapsed .ant-card-body{height:0;overflow:hidden;padding:0}[cePanel]>nz-card.collapsed .collapse-icon,ce-panel>nz-card.collapsed .collapse-icon{transform:rotate(-180deg)}[cePanel]>nz-card .collapse-icon,ce-panel>nz-card .collapse-icon{transform:rotate(0deg);transition:transform .3s ease-in-out}[cePanel]>nz-card .ant-card-head-title,ce-panel>nz-card .ant-card-head-title{cursor:move}[cePanel]>nz-card .ant-card-body,ce-panel>nz-card .ant-card-body{height:calc(100vh - 110px);transition:height .3s ease-in-out,padding .3s ease-in-out}"],encapsulation:2,changeDetection:0});var ke=function(){function e(e,t){var n=this;this.fb=e,this.store=t,this.subscription=new o.Subscription,this.canvasSizeFormGroup=this.fb.group({width:[0,[b.Validators.required,b.Validators.min(0)]],height:[0,[b.Validators.required,b.Validators.min(0)]]}),this.canvasPositionFormGroup=this.fb.group({left:[0,[b.Validators.required]],top:[0,[b.Validators.required]],scale:[1,[b.Validators.min(.01),b.Validators.required]]}),this.canvasBackgroundFormGroup=this.fb.group({backgroundColor:["#ffffff"],backgroundImage:[null]}),this.subscription.add(this.store.selectDifferent((function(e){return e.canvasSize})).subscribe((function(e){n.canvasSizeFormGroup.patchValue(e,{emitEvent:!1})}))),this.subscription.add(this.store.selectDifferent((function(e){return e.canvasPosition})).subscribe((function(e){var t;n.canvasPositionFormGroup.patchValue({left:Math.round(e.left),top:Math.round(e.top),scale:null===(t=e.scale)||void 0===t?void 0:t.toFixed(2)},{emitEvent:!1})}))),this.subscription.add(this.store.selectDifferent((function(e){return e.canvasBackground})).subscribe((function(e){n.canvasBackgroundFormGroup.patchValue(e,{emitEvent:!1})})))}return e.prototype.ngOnInit=function(){var e=this;this.canvasSizeFormGroup.valueChanges.subscribe((function(t){var n;e.store.dispatch((n=t,function(e){return Object.assign(Object.assign({},e),{canvasSize:Object.assign(Object.assign({},e.canvasSize),n)})}))})),this.canvasPositionFormGroup.valueChanges.subscribe((function(t){e.store.dispatch(re(t))})),this.canvasBackgroundFormGroup.valueChanges.subscribe((function(t){var n;console.log(t),e.store.dispatch((n=t,function(e){return Object.assign(Object.assign({},e),{canvasBackground:Object.assign(Object.assign({},e.canvasBackground),n)})}))}))},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e}();ke.ɵfac=function(e){return new(e||ke)(t.ɵɵdirectiveInject(b.FormBuilder),t.ɵɵdirectiveInject(K))},ke.ɵcmp=t.ɵɵdefineComponent({type:ke,selectors:[["ce-canvas-forms"],["","ceCanvasForms",""]],decls:61,vars:4,consts:[["nz-form","","nzLayout","inline",3,"formGroup"],["nzGutter","8"],["nzSpan","12"],["nz-icon","","nzIconfont","icon-kuandu"],["nzSize","small","formControlName","width"],["nz-icon","","nzIconfont","icon-gaodu"],["nzSize","small","formControlName","height"],[1,"mt-2"],["nz-icon","","nzIconfont","icon-left"],["nzSize","small","formControlName","left"],["nz-icon","","nzIconfont","icon-top"],["nzSize","small","formControlName","top"],["nz-icon","","nzIconfont","icon-scale"],["nzSize","small","formControlName","scale"],["nz-icon","","nzIconfont","icon-color"],["type","color","nz-input","","nzSize","small","formControlName","backgroundColor"],["nz-icon","","nzIconfont","icon-image"],["type","text","nz-input","","nzSize","small","formControlName","backgroundImage"],[1,"mt-1"],[3,"max-width","src",4,"ngIf"],[3,"src"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵelementStart(1,"h4"),t.ɵɵtext(2,"画布尺寸"),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"form",0),t.ɵɵelementStart(4,"nz-row",1),t.ɵɵelementStart(5,"nz-col",2),t.ɵɵelementStart(6,"nz-form-item"),t.ɵɵelementStart(7,"nz-form-label"),t.ɵɵelement(8,"i",3),t.ɵɵelementEnd(),t.ɵɵelementStart(9,"nz-form-control"),t.ɵɵelement(10,"nz-input-number",4),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(11,"nz-col",2),t.ɵɵelementStart(12,"nz-form-item"),t.ɵɵelementStart(13,"nz-form-label"),t.ɵɵelement(14,"i",5),t.ɵɵelementEnd(),t.ɵɵelementStart(15,"nz-form-control"),t.ɵɵelement(16,"nz-input-number",6),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(17,"div",7),t.ɵɵelementStart(18,"h4"),t.ɵɵtext(19,"画布位置"),t.ɵɵelementEnd(),t.ɵɵelementStart(20,"form",0),t.ɵɵelementStart(21,"nz-row",1),t.ɵɵelementStart(22,"nz-col",2),t.ɵɵelementStart(23,"nz-form-item"),t.ɵɵelementStart(24,"nz-form-label"),t.ɵɵelement(25,"i",8),t.ɵɵelementEnd(),t.ɵɵelementStart(26,"nz-form-control"),t.ɵɵelement(27,"nz-input-number",9),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(28,"nz-col",2),t.ɵɵelementStart(29,"nz-form-item"),t.ɵɵelementStart(30,"nz-form-label"),t.ɵɵelement(31,"i",10),t.ɵɵelementEnd(),t.ɵɵelementStart(32,"nz-form-control"),t.ɵɵelement(33,"nz-input-number",11),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(34,"nz-col",2),t.ɵɵelementStart(35,"nz-form-item"),t.ɵɵelementStart(36,"nz-form-label"),t.ɵɵelement(37,"i",12),t.ɵɵelementEnd(),t.ɵɵelementStart(38,"nz-form-control"),t.ɵɵelement(39,"nz-input-number",13),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(40,"div",7),t.ɵɵelementStart(41,"h4"),t.ɵɵtext(42,"画布背景"),t.ɵɵelementEnd(),t.ɵɵelementStart(43,"form",0),t.ɵɵelementStart(44,"nz-row",1),t.ɵɵelementStart(45,"nz-col",2),t.ɵɵelementStart(46,"nz-form-item"),t.ɵɵelementStart(47,"nz-form-label"),t.ɵɵelement(48,"i",14),t.ɵɵelementEnd(),t.ɵɵelementStart(49,"nz-form-control"),t.ɵɵelement(50,"input",15),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(51,"nz-col",2),t.ɵɵelementStart(52,"nz-form-item"),t.ɵɵelementStart(53,"nz-form-label"),t.ɵɵelement(54,"i",16),t.ɵɵelementEnd(),t.ɵɵelementStart(55,"nz-form-control"),t.ɵɵelement(56,"input",17),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(57,"h5",18),t.ɵɵtext(58,"背景预览"),t.ɵɵelementEnd(),t.ɵɵelementStart(59,"div"),t.ɵɵtemplate(60,Ne,2,6,"img",19),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(3),t.ɵɵproperty("formGroup",n.canvasSizeFormGroup),t.ɵɵadvance(17),t.ɵɵproperty("formGroup",n.canvasPositionFormGroup),t.ɵɵadvance(23),t.ɵɵproperty("formGroup",n.canvasBackgroundFormGroup),t.ɵɵadvance(17),t.ɵɵproperty("ngIf",n.canvasBackgroundFormGroup.controls.backgroundImage.value))},directives:[b.ɵangular_packages_forms_forms_y,b.NgControlStatusGroup,v.NzFormDirective,b.FormGroupDirective,y.NzRowDirective,y.NzColDirective,v.NzFormItemComponent,v.NzFormLabelComponent,p.ɵNzTransitionPatchDirective,u.NzIconDirective,v.NzFormControlComponent,z.NzInputNumberComponent,b.NgControlStatus,b.FormControlName,S.NzInputDirective,b.DefaultValueAccessor,a.NgIf],pipes:[s.NzSanitizerPipe],styles:["[ceCanvasForms],ce-canvas-forms{display:block;padding:12px}"],encapsulation:2,changeDetection:0});var Be=["container"];function je(e,n){1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"span"),t.ɵɵtext(2,"none"),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd())}function De(e,n){1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(1,"svg",31),t.ɵɵelement(2,"path",32),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd())}function Re(e,n){1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(1,"svg",31),t.ɵɵelement(2,"path",33),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd())}function Ve(e,n){1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(1,"svg",31),t.ɵɵelement(2,"path",34),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd())}function Te(e,n){if(1&e&&(t.ɵɵelementStart(0,"div",28),t.ɵɵelementContainerStart(1,29),t.ɵɵtemplate(2,je,3,0,"ng-container",30),t.ɵɵtemplate(3,De,3,0,"ng-container",30),t.ɵɵtemplate(4,Re,3,0,"ng-container",30),t.ɵɵtemplate(5,Ve,3,0,"ng-container",30),t.ɵɵelementContainerEnd(),t.ɵɵelementEnd()),2&e){var r=n.$implicit;t.ɵɵstyleProp("width",40,"px"),t.ɵɵadvance(1),t.ɵɵproperty("ngSwitch",r.nzValue),t.ɵɵadvance(1),t.ɵɵproperty("ngSwitchCase","none"),t.ɵɵadvance(1),t.ɵɵproperty("ngSwitchCase","dashed"),t.ɵɵadvance(1),t.ɵɵproperty("ngSwitchCase","solid"),t.ɵɵadvance(1),t.ɵɵproperty("ngSwitchCase","dotted")}}function Le(e,n){1&e&&t.ɵɵelementContainer(0)}function $e(e,n){1&e&&t.ɵɵelementContainer(0)}function Fe(e,n){1&e&&t.ɵɵelementContainer(0)}function Ae(e,n){1&e&&t.ɵɵelementContainer(0)}function Ke(e,t){}var qe=function(){return{nzValue:"none"}},Ge=function(e){return{$implicit:e}},He=function(){return{nzValue:"dashed"}},_e=function(){return{nzValue:"solid"}},Ue=function(){return{nzValue:"dotted"}},We=function(){function e(e,t,n){this.fb=e,this.cfr=t,this.store=n,this.boundingFormGroup=this.fb.group({id:[,[b.Validators.required]],name:[],width:[,[b.Validators.required]],height:[,[b.Validators.required]],left:[,[b.Validators.required]],top:[,[b.Validators.required]],locked:[],rotate:[,[b.Validators.required]],zIndex:[,[b.Validators.required]],borderStyle:[],borderWidth:[],borderColor:[],borderRadius:[],backgroundColor:[],backgroundImage:[],backgroundRepeat:[],backgroundPosition:[],backgroundSize:[]})}return e.prototype.ngOnInit=function(){var e=this;this.store.select((function(e){return e.selected})).pipe(n.filter((function(e){return 1===e.size})),n.map((function(e){return T(e)[0]})),n.switchMap((function(t){return e.store.select((function(e){return e.nodes.find((function(e){return e.id===t}))}))})),n.filter((function(e){return!!e}))).subscribe((function(t){e.boundingFormGroup.patchValue(Object.assign(Object.assign({},t),{width:Math.round(t.width),height:Math.round(t.height),left:Math.round(t.left),top:Math.round(t.top)}),{emitEvent:!1})})),this.boundingFormGroup.valueChanges.subscribe((function(t){e.store.dispatch(ie([t]))}))},e}();We.ɵfac=function(e){return new(e||We)(t.ɵɵdirectiveInject(b.FormBuilder),t.ɵɵdirectiveInject(t.ComponentFactoryResolver),t.ɵɵdirectiveInject(K))},We.ɵcmp=t.ɵɵdefineComponent({type:We,selectors:[["ce-widget-form"],["","ceWidgetForm",""]],viewQuery:function(e,n){if(1&e&&t.ɵɵviewQuery(Be,!0),2&e){var r;t.ɵɵqueryRefresh(r=t.ɵɵloadQuery())&&(n.propsFormContainer=r.first)}},decls:70,vars:25,consts:[["nzGhost","","nzAccordion","","nzSize","small",3,"nzBordered"],["nzHeader","外包围盒属性","nzActive",""],["nz-form","","nzLayout","inline",3,"formGroup"],["nzGutter","8"],["nzSpan","12"],["nz-icon","","nzIconfont","icon-kuandu"],["nzSize","small","formControlName","width"],["nz-icon","","nzIconfont","icon-gaodu"],["nzSize","small","formControlName","height"],["nz-icon","","nzIconfont","icon-left"],["nzSize","small","formControlName","left"],["nz-icon","","nzIconfont","icon-top"],["nzSize","small","formControlName","top"],["nz-icon","","nzType","rotate-right"],["nzSize","small","formControlName","rotate"],["nz-icon","","nzType","lock"],["formControlName","locked"],["nzSpan","24"],["nz-icon","","nzType","border-outer"],["borderStyleTpl",""],["nzSize","small","formControlName","borderStyle",3,"nzCustomTemplate"],["nzValue","none","nzLabel","none"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["nzValue","dashed","nzLabel","dashed","nzCustomContent",""],["nzValue","solid","nzLabel","solid","nzCustomContent",""],["nzValue","dotted","nzLabel","dotted","nzCustomContent",""],["nzHeader","组件属性"],["container",""],[1,"d-flex","align-items-center","h-100"],[3,"ngSwitch"],[4,"ngSwitchCase"],["viewBox","0 0 40 1",1,"svg-icon"],["d","M0 1h5V0H0v1zm9 0h5V0H9v1zm10 0h5V0h-5v1zm9 0h5V0h-5v1zm10 0h5V0h-5v1zm9 0h5V0h-5v1zm9 0h5V0h-5v1zm10 0h5V0h-5v1zm9 0h5V0h-5v1z"],["d","M0 0h80v1H0z"],["d","M0 1h1V0H0v1zm4 0h1V0H4v1zm4 0h1V0H8v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1zm4 0h1V0h-1v1z"]],template:function(e,n){if(1&e&&(t.ɵɵelementStart(0,"nz-collapse",0),t.ɵɵelementStart(1,"nz-collapse-panel",1),t.ɵɵelementStart(2,"div"),t.ɵɵelementStart(3,"h5"),t.ɵɵtext(4,"尺寸"),t.ɵɵelementEnd(),t.ɵɵelementStart(5,"form",2),t.ɵɵelementStart(6,"nz-row",3),t.ɵɵelementStart(7,"nz-col",4),t.ɵɵelementStart(8,"nz-form-item"),t.ɵɵelementStart(9,"nz-form-label"),t.ɵɵelement(10,"i",5),t.ɵɵelementEnd(),t.ɵɵelementStart(11,"nz-form-control"),t.ɵɵelement(12,"nz-input-number",6),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(13,"nz-col",4),t.ɵɵelementStart(14,"nz-form-item"),t.ɵɵelementStart(15,"nz-form-label"),t.ɵɵelement(16,"i",7),t.ɵɵelementEnd(),t.ɵɵelementStart(17,"nz-form-control"),t.ɵɵelement(18,"nz-input-number",8),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(19,"h5"),t.ɵɵtext(20,"位置"),t.ɵɵelementEnd(),t.ɵɵelementStart(21,"form",2),t.ɵɵelementStart(22,"nz-row",3),t.ɵɵelementStart(23,"nz-col",4),t.ɵɵelementStart(24,"nz-form-item"),t.ɵɵelementStart(25,"nz-form-label"),t.ɵɵelement(26,"i",9),t.ɵɵelementEnd(),t.ɵɵelementStart(27,"nz-form-control"),t.ɵɵelement(28,"nz-input-number",10),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(29,"nz-col",4),t.ɵɵelementStart(30,"nz-form-item"),t.ɵɵelementStart(31,"nz-form-label"),t.ɵɵelement(32,"i",11),t.ɵɵelementEnd(),t.ɵɵelementStart(33,"nz-form-control"),t.ɵɵelement(34,"nz-input-number",12),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(35,"nz-col",4),t.ɵɵelementStart(36,"nz-form-item"),t.ɵɵelementStart(37,"nz-form-label"),t.ɵɵelement(38,"i",13),t.ɵɵelementEnd(),t.ɵɵelementStart(39,"nz-form-control"),t.ɵɵelement(40,"nz-input-number",14),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(41,"nz-col",4),t.ɵɵelementStart(42,"nz-form-item"),t.ɵɵelementStart(43,"nz-form-label"),t.ɵɵelement(44,"i",15),t.ɵɵelementEnd(),t.ɵɵelementStart(45,"nz-form-control"),t.ɵɵelement(46,"nz-switch",16),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(47,"h5"),t.ɵɵtext(48,"边框"),t.ɵɵelementEnd(),t.ɵɵelementStart(49,"form",2),t.ɵɵelementStart(50,"nz-row",3),t.ɵɵelementStart(51,"nz-col",17),t.ɵɵelementStart(52,"nz-form-item"),t.ɵɵelementStart(53,"nz-form-label"),t.ɵɵelement(54,"i",18),t.ɵɵelementEnd(),t.ɵɵelementStart(55,"nz-form-control"),t.ɵɵtemplate(56,Te,6,7,"ng-template",null,19,t.ɵɵtemplateRefExtractor),t.ɵɵelementStart(58,"nz-select",20),t.ɵɵelementStart(59,"nz-option",21),t.ɵɵtemplate(60,Le,1,0,"ng-container",22),t.ɵɵelementEnd(),t.ɵɵelementStart(61,"nz-option",23),t.ɵɵtemplate(62,$e,1,0,"ng-container",22),t.ɵɵelementEnd(),t.ɵɵelementStart(63,"nz-option",24),t.ɵɵtemplate(64,Fe,1,0,"ng-container",22),t.ɵɵelementEnd(),t.ɵɵelementStart(65,"nz-option",25),t.ɵɵtemplate(66,Ae,1,0,"ng-container",22),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(67,"nz-collapse-panel",26),t.ɵɵtemplate(68,Ke,0,0,"ng-template",null,27,t.ɵɵtemplateRefExtractor),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e){var r=t.ɵɵreference(57);t.ɵɵproperty("nzBordered",!1),t.ɵɵadvance(5),t.ɵɵproperty("formGroup",n.boundingFormGroup),t.ɵɵadvance(16),t.ɵɵproperty("formGroup",n.boundingFormGroup),t.ɵɵadvance(28),t.ɵɵproperty("formGroup",n.boundingFormGroup),t.ɵɵadvance(9),t.ɵɵproperty("nzCustomTemplate",r),t.ɵɵadvance(2),t.ɵɵproperty("ngTemplateOutlet",r)("ngTemplateOutletContext",t.ɵɵpureFunction1(14,Ge,t.ɵɵpureFunction0(13,qe))),t.ɵɵadvance(2),t.ɵɵproperty("ngTemplateOutlet",r)("ngTemplateOutletContext",t.ɵɵpureFunction1(17,Ge,t.ɵɵpureFunction0(16,He))),t.ɵɵadvance(2),t.ɵɵproperty("ngTemplateOutlet",r)("ngTemplateOutletContext",t.ɵɵpureFunction1(20,Ge,t.ɵɵpureFunction0(19,_e))),t.ɵɵadvance(2),t.ɵɵproperty("ngTemplateOutlet",r)("ngTemplateOutletContext",t.ɵɵpureFunction1(23,Ge,t.ɵɵpureFunction0(22,Ue)))}},directives:[x.NzCollapseComponent,x.NzCollapsePanelComponent,b.ɵangular_packages_forms_forms_y,b.NgControlStatusGroup,v.NzFormDirective,b.FormGroupDirective,y.NzRowDirective,y.NzColDirective,v.NzFormItemComponent,v.NzFormLabelComponent,p.ɵNzTransitionPatchDirective,u.NzIconDirective,v.NzFormControlComponent,z.NzInputNumberComponent,b.NgControlStatus,b.FormControlName,w.NzSwitchComponent,O.NzSelectComponent,O.NzOptionComponent,a.NgTemplateOutlet,a.NgSwitch,a.NgSwitchCase],styles:["[ceWidgetForm],ce-widget-form{display:block}[ceWidgetForm] .ant-collapse-ghost>.ant-collapse-item,ce-widget-form .ant-collapse-ghost>.ant-collapse-item{border-bottom:1px solid #d9d9d9}[ceWidgetForm] .ant-collapse-ghost>.ant-collapse-item>.ant-collapse-header,ce-widget-form .ant-collapse-ghost>.ant-collapse-item>.ant-collapse-header{padding-left:20px}[ceWidgetForm] .ant-collapse-ghost>.ant-collapse-item>.ant-collapse-header .ant-collapse-arrow,ce-widget-form .ant-collapse-ghost>.ant-collapse-item>.ant-collapse-header .ant-collapse-arrow{left:5px}[ceWidgetForm] .ant-collapse-ghost>.ant-collapse-item>.ant-collapse-content>.ant-collapse-content-box,ce-widget-form .ant-collapse-ghost>.ant-collapse-item>.ant-collapse-content>.ant-collapse-content-box{padding:8px}[ceWidgetForm] .ant-form-item-control-input-content,ce-widget-form .ant-form-item-control-input-content{align-items:center;display:flex}"],encapsulation:2});var Ye=["instance"];function Qe(e,n){1&e&&t.ɵɵelementContainer(0)}var Xe=function(){function e(e){this.store=e}return e.prototype.ngOnInit=function(){this.formComponent$=this.store.select((function(e){return e.selected.size})).pipe(n.map((function(e){return 1===e?We:ke})))},e}();function Ze(e,n){1&e&&t.ɵɵelement(0,"ce-rotate-handle")}function Je(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",17),t.ɵɵlistener("ceOnStart",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizeStart(e)}))("ceOnMove",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizing(e,"t")}))("ceOnStop",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizeEnd()})),t.ɵɵelementEnd()}}function et(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",18),t.ɵɵlistener("ceOnStart",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizeStart(e)}))("ceOnMove",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizing(e,"r")}))("ceOnStop",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizeEnd()})),t.ɵɵelementEnd()}}function tt(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",19),t.ɵɵlistener("ceOnStart",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizeStart(e)}))("ceOnMove",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizing(e,"b")}))("ceOnStop",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizeEnd()})),t.ɵɵelementEnd()}}function nt(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",20),t.ɵɵlistener("ceOnStart",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizeStart(e)}))("ceOnMove",(function(e){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizing(e,"l")}))("ceOnStop",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().resizeEnd()})),t.ɵɵelementEnd()}}function rt(e,n){1&e&&t.ɵɵelement(0,"div",21)}function it(e,n){1&e&&t.ɵɵelement(0,"div",22)}function ot(e,n){1&e&&t.ɵɵelement(0,"div",23)}function at(e,n){1&e&&t.ɵɵelement(0,"div",24)}Xe.ɵfac=function(e){return new(e||Xe)(t.ɵɵdirectiveInject(K))},Xe.ɵcmp=t.ɵɵdefineComponent({type:Xe,selectors:[["ce-property-form"],["","cePropertyForm",""]],viewQuery:function(e,n){if(1&e&&t.ɵɵviewQuery(Ye,!0),2&e){var r;t.ɵɵqueryRefresh(r=t.ɵɵloadQuery())&&(n.instance=r.first)}},decls:2,vars:3,consts:[[4,"ngComponentOutlet"]],template:function(e,n){1&e&&(t.ɵɵtemplate(0,Qe,1,0,"ng-container",0),t.ɵɵpipe(1,"async")),2&e&&t.ɵɵproperty("ngComponentOutlet",t.ɵɵpipeBind1(1,1,n.formComponent$))},directives:[a.NgComponentOutlet],pipes:[a.AsyncPipe],styles:["[cePropertyForm],ce-property-form{display:block;margin:-12px}"],encapsulation:2,changeDetection:0});var st=function(){function e(e,t,n){var r=this;this.store=e,this.utils=t,this.eleRef=n,this.display="none",this.nodePositionSnapshotList=new Map,this.selectedSize$=this.store.selectDifferent((function(e){return e.selected.size})),this.store.selectDifferent((function(e){return{selected:e.selected,canvasPosition:e.canvasPosition,nodes:e.nodes}})).subscribe((function(e){var t=e.selected,n=e.canvasPosition,i=e.nodes;r.display=t.size?"block":"none",r.selected=t,r.canvasPosition=n,r.nodes=i,r.selected.size&&r.refreshResizeHandle()}))}return Object.defineProperty(e.prototype,"transform",{get:function(){var e;return"rotate("+(null!==(e=this.rotate)&&void 0!==e?e:0)+"deg)"},enumerable:!1,configurable:!0}),e.prototype.refreshResizeHandle=function(){if(this.selected&&this.nodes){var e=this.utils.getResizeBoundingBox(T(this.selected),this.nodes),t=e.left,n=e.top,r=e.width,i=e.height,o=e.rotate;this.left=t*this.canvasPosition.scale,this.top=n*this.canvasPosition.scale,this.width=r*this.canvasPosition.scale,this.height=i*this.canvasPosition.scale,this.rotate=o}},e.prototype.resizeStart=function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.canvasPosition.scale,r=document.querySelector("ce-canvas").getBoundingClientRect();this.groupRectSnapshot={width:this.width/n,height:this.height/n,left:this.left/n,top:this.top/n},this.groupAbsolutePositionSnapshot=this.utils.getAbsolutePosition((this.left+this.width/2)/n,(this.top+this.height/2)/n,this.width/n,this.height/n),this.resizePointSnapshot={absolute:[e.clientX,e.clientY],relative:[(e.clientX-r.left)/n,(e.clientY-r.top)/n]},this.selected.forEach((function(e){var n=t.utils.getNodeById(e,t.nodes),r=t.utils.getAbsolutePosition(n.left+n.width/2,n.top+n.height/2,n.width,n.height,n.rotate);if(t.selected.size>1){t.resizeMode="GROUP";var i=t.utils.getItemPercentPositionInGroup(Object.assign({},t.groupRectSnapshot),r);t.nodePositionSnapshotList.set(e,i)}else t.resizeMode="SINGLE",t.nodePositionSnapshotList.set(e,r)}))},e.prototype.resizing=function(e,t){if(this.resizePointSnapshot&&this.groupRectSnapshot&&this.resizeMode){var n=V([e.clientX-this.resizePointSnapshot.absolute[0],e.clientY-this.resizePointSnapshot.absolute[1]],2),r=n[0],i=n[1];switch(this.resizeMode){case"GROUP":this.resizingNodeList(t,r,i);break;case"SINGLE":this.resizingNode(t,r,i)}}},e.prototype.resizeEnd=function(){this.groupRectSnapshot=null,this.resizePointSnapshot=null,this.nodePositionSnapshotList.clear()},e.prototype.resizingNodeList=function(e,t,n){var r=this,i=this.canvasPosition.scale,o=this.resizePointSnapshot.relative,a=function(e,t,n){switch(e){case"tl":case"tr":return t[1]>=F.shared.getPointInLine("y",t[0],n)?[t[0],F.shared.getPointInLine("y",t[0],n)]:[F.shared.getPointInLine("x",t[1],n),t[1]];case"bl":case"br":return t[1]>=F.shared.getPointInLine("y",t[0],n)?[F.shared.getPointInLine("x",t[1],n),t[1]]:[t[0],F.shared.getPointInLine("y",t[0],n)]}}(e,[o[0]+t/i,o[1]+n/i],function(e,t){var n=F.shared.getVerticalAndHorizontalPointByAbsolutePosition(t);switch(e){case"tl":case"br":return[t.tl,t.br];case"tr":case"bl":return[t.tr,t.bl];case"t":case"b":return[n.t,n.b];case"l":case"r":return[n.l,n.r]}}(e,this.groupAbsolutePositionSnapshot)),s=function(e,t,n){switch(e){case"tl":return{left:n[0],top:n[1],width:t.tr[0]-n[0],height:t.bl[1]-n[1]};case"tr":return{left:t.tl[0],top:n[1],width:n[0]-t.tl[0],height:t.br[1]-n[1]};case"br":return{left:t.tl[0],top:t.tl[1],width:n[0]-t.bl[0],height:n[1]-t.tr[1]};case"bl":return{left:n[0],top:t.tl[1],width:t.br[0]-n[0],height:n[1]-t.tl[1]}}}(e,this.groupAbsolutePositionSnapshot,a),l=new Map;this.nodePositionSnapshotList.forEach((function(e,t){var n=e.tl,i=e.bl,o=e.br,a=e.tr;l.set(t,r.utils.getRelativePosition({bl:[i[0]*s.width+s.left,i[1]*s.height+s.top],br:[o[0]*s.width+s.left,o[1]*s.height+s.top],tl:[n[0]*s.width+s.left,n[1]*s.height+s.top],tr:[a[0]*s.width+s.left,a[1]*s.height+s.top]}))})),this.store.dispatch(oe(l))},e.prototype.resizingNode=function(e,t,n){var r=this,i=this.canvasPosition.scale,o=this.resizePointSnapshot.relative,a=[o[0]+t/i,o[1]+n/i];this.nodePositionSnapshotList.forEach((function(t,n){r.store.dispatch(oe(new Map([[n,lt(e,t,a)]])))}))},e}();function lt(e,t,n){var r,i,o,a,s=t.bl,l=t.br,c=t.tl,d=t.tr;switch(e){case"tl":return i=F.shared.getVerticalLineCrossPoint(l,d,n),o=F.shared.getVerticalLineCrossPoint(l,s,n),F.shared.getRelativePosition({tl:n,tr:i,bl:o,br:l});case"tr":return r=F.shared.getVerticalLineCrossPoint(s,c,n),a=F.shared.getVerticalLineCrossPoint(s,l,n),F.shared.getRelativePosition({tl:r,tr:n,bl:s,br:a});case"bl":return r=F.shared.getVerticalLineCrossPoint(d,c,n),a=F.shared.getVerticalLineCrossPoint(d,l,n),F.shared.getRelativePosition({tl:r,tr:d,bl:n,br:a});case"br":return i=F.shared.getVerticalLineCrossPoint(c,d,n),o=F.shared.getVerticalLineCrossPoint(c,s,n),F.shared.getRelativePosition({tl:c,tr:i,bl:o,br:n});case"t":return r=F.shared.getVerticalLineCrossPoint(s,c,n),i=F.shared.getVerticalLineCrossPoint(l,d,n),F.shared.getRelativePosition({tl:r,tr:i,bl:s,br:l});case"r":return i=F.shared.getVerticalLineCrossPoint(c,d,n),a=F.shared.getVerticalLineCrossPoint(s,l,n),F.shared.getRelativePosition({tl:c,tr:i,bl:s,br:a});case"b":return o=F.shared.getVerticalLineCrossPoint(c,s,n),a=F.shared.getVerticalLineCrossPoint(d,l,n),F.shared.getRelativePosition({tl:c,tr:d,bl:o,br:a});case"l":return r=F.shared.getVerticalLineCrossPoint(d,c,n),o=F.shared.getVerticalLineCrossPoint(l,s,n),F.shared.getRelativePosition({tl:r,tr:d,bl:o,br:l})}}st.ɵfac=function(e){return new(e||st)(t.ɵɵdirectiveInject(K),t.ɵɵdirectiveInject(F),t.ɵɵdirectiveInject(t.ElementRef))},st.ɵcmp=t.ɵɵdefineComponent({type:st,selectors:[["ce-resize-handle"],["","ceResizeHandle",""]],hostVars:12,hostBindings:function(e,n){2&e&&t.ɵɵstyleProp("display",n.display)("width",n.width,"px")("height",n.height,"px")("left",n.left,"px")("top",n.top,"px")("transform",n.transform)},decls:26,vars:27,consts:[[4,"ngIf"],["class","resizable-handle t","ceDraggable","",3,"ceOnStart","ceOnMove","ceOnStop",4,"ngIf"],["class","resizable-handle r","ceDraggable","",3,"ceOnStart","ceOnMove","ceOnStop",4,"ngIf"],["class","resizable-handle b","ceDraggable","",3,"ceOnStart","ceOnMove","ceOnStop",4,"ngIf"],["class","resizable-handle l","ceDraggable","",3,"ceOnStart","ceOnMove","ceOnStop",4,"ngIf"],["ceDraggable","",1,"resizable-handle","tr",3,"ceOnStart","ceOnMove","ceOnStop"],["ceDraggable","",1,"resizable-handle","br",3,"ceOnStart","ceOnMove","ceOnStop"],["ceDraggable","",1,"resizable-handle","tl",3,"ceOnStart","ceOnMove","ceOnStop"],["ceDraggable","",1,"resizable-handle","bl",3,"ceOnStart","ceOnMove","ceOnStop"],["class","t circle",4,"ngIf"],["class","r circle",4,"ngIf"],["class","b circle",4,"ngIf"],["class","l circle",4,"ngIf"],[1,"tr","circle"],[1,"br","circle"],[1,"tl","circle"],[1,"bl","circle"],["ceDraggable","",1,"resizable-handle","t",3,"ceOnStart","ceOnMove","ceOnStop"],["ceDraggable","",1,"resizable-handle","r",3,"ceOnStart","ceOnMove","ceOnStop"],["ceDraggable","",1,"resizable-handle","b",3,"ceOnStart","ceOnMove","ceOnStop"],["ceDraggable","",1,"resizable-handle","l",3,"ceOnStart","ceOnMove","ceOnStop"],[1,"t","circle"],[1,"r","circle"],[1,"b","circle"],[1,"l","circle"]],template:function(e,n){1&e&&(t.ɵɵtemplate(0,Ze,1,0,"ce-rotate-handle",0),t.ɵɵpipe(1,"async"),t.ɵɵtemplate(2,Je,1,0,"div",1),t.ɵɵpipe(3,"async"),t.ɵɵtemplate(4,et,1,0,"div",2),t.ɵɵpipe(5,"async"),t.ɵɵtemplate(6,tt,1,0,"div",3),t.ɵɵpipe(7,"async"),t.ɵɵtemplate(8,nt,1,0,"div",4),t.ɵɵpipe(9,"async"),t.ɵɵelementStart(10,"div",5),t.ɵɵlistener("ceOnStart",(function(e){return n.resizeStart(e)}))("ceOnMove",(function(e){return n.resizing(e,"tr")}))("ceOnStop",(function(){return n.resizeEnd()})),t.ɵɵelementEnd(),t.ɵɵelementStart(11,"div",6),t.ɵɵlistener("ceOnStart",(function(e){return n.resizeStart(e)}))("ceOnMove",(function(e){return n.resizing(e,"br")}))("ceOnStop",(function(){return n.resizeEnd()})),t.ɵɵelementEnd(),t.ɵɵelementStart(12,"div",7),t.ɵɵlistener("ceOnStart",(function(e){return n.resizeStart(e)}))("ceOnMove",(function(e){return n.resizing(e,"tl")}))("ceOnStop",(function(){return n.resizeEnd()})),t.ɵɵelementEnd(),t.ɵɵelementStart(13,"div",8),t.ɵɵlistener("ceOnStart",(function(e){return n.resizeStart(e)}))("ceOnMove",(function(e){return n.resizing(e,"bl")}))("ceOnStop",(function(){return n.resizeEnd()})),t.ɵɵelementEnd(),t.ɵɵtemplate(14,rt,1,0,"div",9),t.ɵɵpipe(15,"async"),t.ɵɵtemplate(16,it,1,0,"div",10),t.ɵɵpipe(17,"async"),t.ɵɵtemplate(18,ot,1,0,"div",11),t.ɵɵpipe(19,"async"),t.ɵɵtemplate(20,at,1,0,"div",12),t.ɵɵpipe(21,"async"),t.ɵɵelement(22,"div",13),t.ɵɵelement(23,"div",14),t.ɵɵelement(24,"div",15),t.ɵɵelement(25,"div",16)),2&e&&(t.ɵɵproperty("ngIf",1===t.ɵɵpipeBind1(1,9,n.selectedSize$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",t.ɵɵpipeBind1(3,11,n.selectedSize$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",t.ɵɵpipeBind1(5,13,n.selectedSize$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",t.ɵɵpipeBind1(7,15,n.selectedSize$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",t.ɵɵpipeBind1(9,17,n.selectedSize$)),t.ɵɵadvance(6),t.ɵɵproperty("ngIf",1===t.ɵɵpipeBind1(15,19,n.selectedSize$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",1===t.ɵɵpipeBind1(17,21,n.selectedSize$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",1===t.ɵɵpipeBind1(19,23,n.selectedSize$)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",1===t.ɵɵpipeBind1(21,25,n.selectedSize$)))},styles:["[ceResizeHandle],ce-resize-handle{border:1px solid #1890ff;box-sizing:border-box;position:absolute}[ceResizeHandle] .resizable-handle,ce-resize-handle .resizable-handle{cursor:pointer;height:14px;pointer-events:auto;position:absolute;width:14px;z-index:1}[ceResizeHandle] .circle,ce-resize-handle .circle{background:#fff;border:1px solid #1890ff;border-radius:50%;height:7px;position:absolute;width:7px}[ceResizeHandle] .b,[ceResizeHandle] .t,ce-resize-handle .b,ce-resize-handle .t{left:50%;margin-left:-3.5px}[ceResizeHandle] .b.resizable-handle,[ceResizeHandle] .t.resizable-handle,ce-resize-handle .b.resizable-handle,ce-resize-handle .t.resizable-handle{margin-left:-7px}[ceResizeHandle] .l,[ceResizeHandle] .r,ce-resize-handle .l,ce-resize-handle .r{margin-top:-3.5px;top:50%}[ceResizeHandle] .l.resizable-handle,[ceResizeHandle] .r.resizable-handle,ce-resize-handle .l.resizable-handle,ce-resize-handle .r.resizable-handle{margin-top:-7px}[ceResizeHandle] .t,[ceResizeHandle] .tl,[ceResizeHandle] .tr,ce-resize-handle .t,ce-resize-handle .tl,ce-resize-handle .tr{top:-3.5px}[ceResizeHandle] .t.resizable-handle,[ceResizeHandle] .tl.resizable-handle,[ceResizeHandle] .tr.resizable-handle,ce-resize-handle .t.resizable-handle,ce-resize-handle .tl.resizable-handle,ce-resize-handle .tr.resizable-handle{top:-7px}[ceResizeHandle] .b,[ceResizeHandle] .bl,[ceResizeHandle] .br,ce-resize-handle .b,ce-resize-handle .bl,ce-resize-handle .br{bottom:-3.5px}[ceResizeHandle] .b.resizable-handle,[ceResizeHandle] .bl.resizable-handle,[ceResizeHandle] .br.resizable-handle,ce-resize-handle .b.resizable-handle,ce-resize-handle .bl.resizable-handle,ce-resize-handle .br.resizable-handle{bottom:-7px}[ceResizeHandle] .br,[ceResizeHandle] .r,[ceResizeHandle] .tr,ce-resize-handle .br,ce-resize-handle .r,ce-resize-handle .tr{right:-3.5px}[ceResizeHandle] .br.resizable-handle,[ceResizeHandle] .r.resizable-handle,[ceResizeHandle] .tr.resizable-handle,ce-resize-handle .br.resizable-handle,ce-resize-handle .r.resizable-handle,ce-resize-handle .tr.resizable-handle{right:-7px}[ceResizeHandle] .bl,[ceResizeHandle] .l,[ceResizeHandle] .tl,ce-resize-handle .bl,ce-resize-handle .l,ce-resize-handle .tl{left:-3.5px}[ceResizeHandle] .bl.resizable-handle,[ceResizeHandle] .l.resizable-handle,[ceResizeHandle] .tl.resizable-handle,ce-resize-handle .bl.resizable-handle,ce-resize-handle .l.resizable-handle,ce-resize-handle .tl.resizable-handle{left:-7px}"],encapsulation:2,changeDetection:0});var ct=function(){function e(e,t,n){this.parent=e,this.store=t,this.utils=n,this.rotateSnapshot=null}return e.prototype.ngOnInit=function(){var e=this;this.store.select((function(e){return e.selected})).subscribe((function(t){return e.selected=t})),this.store.select((function(e){return e.nodes})).subscribe((function(t){return e.nodes=t}))},e.prototype.rotateStart=function(e){e.stopPropagation(),e.preventDefault();var t=this.parent.eleRef.nativeElement.getBoundingClientRect().toJSON();this.rotateSnapshot=[t.left+t.width/2,t.top+t.height/2,t.left+t.width/2,t.top+t.height/2-100,this.utils.getNodeById(T(this.selected)[0],this.nodes)]},e.prototype.rotating=function(e){if(this.rotateSnapshot){var t=V(this.rotateSnapshot,5),n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=e.clientX,l=e.clientY,c=Math.round(this.utils.getRotate(n,r,i,o,s,l));this.store.dispatch(ie([Object.assign(Object.assign({},a),{rotate:360===c?0:c})]))}},e.prototype.rotateStop=function(){this.rotateSnapshot=null},e}();ct.ɵfac=function(e){return new(e||ct)(t.ɵɵdirectiveInject(st,12),t.ɵɵdirectiveInject(K),t.ɵɵdirectiveInject(F))},ct.ɵcmp=t.ɵɵdefineComponent({type:ct,selectors:[["ce-rotate-handle"]],decls:3,vars:2,consts:[["ceDraggable","",1,"rotate",3,"ceOnStart","ceOnMove","ceOnStop"],["width","14","height","14","xmlns","http://www.w3.org/2000/svg"],["d","M10.536 3.464A5 5 0 1 0 11 10l1.424 1.425a7 7 0 1 1-.475-9.374L13.659.34A.2.2 0 0 1 14 .483V5.5a.5.5 0 0 1-.5.5H8.483a.2.2 0 0 1-.142-.341l2.195-2.195z","fill-rule","nonzero"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵlistener("ceOnStart",(function(e){return n.rotateStart(e)}))("ceOnMove",(function(e){return n.rotating(e)}))("ceOnStop",(function(){return n.rotateStop()})),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(1,"svg",1),t.ɵɵelement(2,"path",2),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&t.ɵɵstyleProp("cursor",n.rotateSnapshot&&"grabbing")},directives:[de],styles:[".rotate{align-items:center;cursor:grab;display:flex;height:18px;justify-content:center;left:50%;margin-left:-9px;pointer-events:auto;position:absolute;top:-26px;width:18px}.rotate path{fill:#1890ff}"],encapsulation:2,changeDetection:0});var dt=function(e){var t=this;this.store=e,this.store.select((function(e){return Object.assign(Object.assign({},e.canvasSize),{scale:e.canvasPosition.scale})})).subscribe((function(e){t.width=e.width*e.scale,t.height=e.height*e.scale}))};dt.ɵfac=function(e){return new(e||dt)(t.ɵɵdirectiveInject(K))},dt.ɵdir=t.ɵɵdefineDirective({type:dt,selectors:[["","ceNoZoomArea",""]],hostVars:4,hostBindings:function(e,n){2&e&&t.ɵɵstyleProp("width",n.width,"px")("height",n.height,"px")},exportAs:["ceNoZoomArea"]});var pt=function(){function e(e){this.eleRef=e,this.subscription=new o.Subscription,this.move$=o.fromEvent(window,"pointermove"),this.up$=o.fromEvent(window,"pointerup"),this.startPointSnapshot=null,this.ceSelectorDisabled=!1,this.ceOnSelectorStart=new t.EventEmitter,this.ceOnSelectorMoving=new t.EventEmitter,this.ceOnSelectorStop=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this.subscription.add(o.fromEvent(this.eleRef.nativeElement,"pointerdown").pipe(n.filter((function(e){return 0===e.button})),n.filter((function(){return!e.ceSelectorDisabled})),n.switchMap((function(t){return e.boxRect=e.eleRef.nativeElement.getBoundingClientRect(),e.startPointSnapshot=[t.clientX,t.clientY],e.ceOnSelectorStart.emit(),e.move$.pipe(n.finalize((function(){e.startPointSnapshot=null,e.ceOnSelectorStop.emit()})),n.takeUntil(e.up$))}))).subscribe((function(t){if(e.startPointSnapshot){var n=void 0,r=void 0,i=V([t.clientX-e.startPointSnapshot[0],t.clientY-e.startPointSnapshot[1]],2),o=i[0],a=i[1];n=o>=0?e.startPointSnapshot[0]-e.boxRect.left:t.clientX-e.boxRect.left,r=a>=0?e.startPointSnapshot[1]-e.boxRect.top:t.clientY-e.boxRect.top,e.ceOnSelectorMoving.emit({x:n,y:r,width:Math.abs(o),height:Math.abs(a)})}})))},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e}();pt.ɵfac=function(e){return new(e||pt)(t.ɵɵdirectiveInject(t.ElementRef))},pt.ɵdir=t.ɵɵdefineDirective({type:pt,selectors:[["","ceSelector",""]],inputs:{ceSelectorDisabled:"ceSelectorDisabled"},outputs:{ceOnSelectorStart:"ceOnSelectorStart",ceOnSelectorMoving:"ceOnSelectorMoving",ceOnSelectorStop:"ceOnSelectorStop"},exportAs:["ceSelector"]}),R([l.InputBoolean()],pt.prototype,"ceSelectorDisabled",void 0);var ut=function(e){var t=this;this.store=e,this.transformOrigin="0 0",this.store.select((function(e){return Object.assign(Object.assign({},e.canvasSize),{scale:e.canvasPosition.scale})})).subscribe((function(e){t.scale="perspective(1px) scale("+e.scale+")",t.width=e.width,t.height=e.height}))};ut.ɵfac=function(e){return new(e||ut)(t.ɵɵdirectiveInject(K))},ut.ɵdir=t.ɵɵdefineDirective({type:ut,selectors:[["","ceZoomArea",""]],hostVars:8,hostBindings:function(e,n){2&e&&t.ɵɵstyleProp("transform-origin",n.transformOrigin)("transform",n.scale)("width",n.width,"px")("height",n.height,"px")},exportAs:["ceZoomArea"]});var ht=function(){};function ft(e,n){1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵprojection(1),t.ɵɵelementContainerEnd())}function mt(e,n){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"nz-card",2),t.ɵɵelementStart(1,"div",3),t.ɵɵelementStart(2,"span",4),t.ɵɵtext(3,"Canvas Title"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"div",5),t.ɵɵelementStart(5,"button",6),t.ɵɵpipe(6,"async"),t.ɵɵelement(7,"i",7),t.ɵɵelementEnd(),t.ɵɵelementStart(8,"button",8),t.ɵɵelement(9,"i",9),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(10,"div",5),t.ɵɵelementStart(11,"button",10),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().groupNodes()})),t.ɵɵpipe(12,"async"),t.ɵɵelement(13,"i",11),t.ɵɵelementEnd(),t.ɵɵelementStart(14,"button",10),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().breakNode()})),t.ɵɵpipe(15,"async"),t.ɵɵelement(16,"i",12),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(17,"div",5),t.ɵɵelementStart(18,"button",6),t.ɵɵpipe(19,"async"),t.ɵɵelement(20,"i",13),t.ɵɵelementEnd(),t.ɵɵelementStart(21,"button",6),t.ɵɵpipe(22,"async"),t.ɵɵelement(23,"i",14),t.ɵɵelementEnd(),t.ɵɵelementStart(24,"button",6),t.ɵɵpipe(25,"async"),t.ɵɵelement(26,"i",15),t.ɵɵelementEnd(),t.ɵɵelementStart(27,"button",6),t.ɵɵpipe(28,"async"),t.ɵɵelement(29,"i",16),t.ɵɵelementEnd(),t.ɵɵelementStart(30,"button",6),t.ɵɵpipe(31,"async"),t.ɵɵelement(32,"i",17),t.ɵɵelementEnd(),t.ɵɵelementStart(33,"button",6),t.ɵɵpipe(34,"async"),t.ɵɵelement(35,"i",18),t.ɵɵelementEnd(),t.ɵɵelementStart(36,"button",6),t.ɵɵpipe(37,"async"),t.ɵɵelement(38,"i",19),t.ɵɵelementEnd(),t.ɵɵelementStart(39,"button",6),t.ɵɵpipe(40,"async"),t.ɵɵelement(41,"i",20),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(42,"div",5),t.ɵɵelementStart(43,"nz-tag",21),t.ɵɵlistener("nzCheckedChange",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().store.togglePanelVisible("LAYERS")})),t.ɵɵelement(44,"i",22),t.ɵɵelementStart(45,"span"),t.ɵɵtext(46,"图层"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(47,"nz-tag",21),t.ɵɵlistener("nzCheckedChange",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().store.togglePanelVisible("WIDGET_LIST")})),t.ɵɵelement(48,"i",23),t.ɵɵelementStart(49,"span"),t.ɵɵtext(50,"组件"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(51,"nz-tag",21),t.ɵɵlistener("nzCheckedChange",(function(){return t.ɵɵrestoreView(r),t.ɵɵnextContext().store.togglePanelVisible("PROPERTIES")})),t.ɵɵelement(52,"i",24),t.ɵɵelementStart(53,"span"),t.ɵɵtext(54,"属性"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(55,"div",5),t.ɵɵelementStart(56,"button",8),t.ɵɵelement(57,"i",25),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i,o,a,s=t.ɵɵnextContext();t.ɵɵadvance(5),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(6,14,s.copyStatus$)),t.ɵɵadvance(6),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(12,16,s.groupStatus$)),t.ɵɵadvance(3),t.ɵɵproperty("disabled",!t.ɵɵpipeBind1(15,18,s.breakStatus$)),t.ɵɵadvance(4),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(19,20,s.groupStatus$)),t.ɵɵadvance(3),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(22,22,s.groupStatus$)),t.ɵɵadvance(3),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(25,24,s.groupStatus$)),t.ɵɵadvance(3),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(28,26,s.groupStatus$)),t.ɵɵadvance(3),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(31,28,s.groupStatus$)),t.ɵɵadvance(3),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(34,30,s.groupStatus$)),t.ɵɵadvance(3),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(37,32,s.groupStatus$)),t.ɵɵadvance(3),t.ɵɵproperty("disabled",t.ɵɵpipeBind1(40,34,s.groupStatus$)),t.ɵɵadvance(4),t.ɵɵproperty("nzChecked",null==(i=s.store.getPanel("LAYERS"))?null:i.show),t.ɵɵadvance(4),t.ɵɵproperty("nzChecked",null==(o=s.store.getPanel("WIDGET_LIST"))?null:o.show),t.ɵɵadvance(4),t.ɵɵproperty("nzChecked",null==(a=s.store.getPanel("PROPERTIES"))?null:a.show)}}ht.ɵfac=function(e){return new(e||ht)},ht.ɵdir=t.ɵɵdefineDirective({type:ht,selectors:[["","ceToolbar",""]],exportAs:["ceToolbar"]});var gt=[[["","ceToolbar",""]]],bt=function(){function e(e,t){var r=this;this.store=e,this.utils=t,this.store.selectDifferent((function(e){return{selected:e.selected,nodes:e.nodes}})).subscribe((function(e){var t=e.selected,n=e.nodes;r.selected=t,r.nodes=n})),this.selected$=this.store.selectDifferent((function(e){return e.selected})),this.groupStatus$=this.selected$.pipe(n.map((function(e){return e.size<=1}))),this.breakStatus$=this.selected$.pipe(n.map((function(e){return 1===e.size&&T(e)[0]})),n.map((function(e){var t,n;return e&&!!(null===(n=null===(t=r.utils.getNodeById(e,r.nodes))||void 0===t?void 0:t.children)||void 0===n?void 0:n.length)})))}return Object.defineProperty(e.prototype,"copyStatus$",{get:function(){return this.selected$.pipe(n.map((function(e){return 0===e.size})))},enumerable:!1,configurable:!0}),e.prototype.groupNodes=function(){var e=T(this.selected);this.store.dispatch(X()),this.store.dispatch(J()),this.store.dispatch(ae(e))},e.prototype.breakNode=function(){var e=this.utils.getNodeById(T(this.selected)[0],this.nodes);this.store.dispatch(X()),this.store.dispatch(J()),this.store.dispatch(se(e.id))},e}();bt.ɵfac=function(e){return new(e||bt)(t.ɵɵdirectiveInject(K),t.ɵɵdirectiveInject(F))},bt.ɵcmp=t.ɵɵdefineComponent({type:bt,selectors:[["ce-toolbar"]],contentQueries:function(e,n,r){if(1&e&&t.ɵɵcontentQuery(r,ht,!0),2&e){var i;t.ɵɵqueryRefresh(i=t.ɵɵloadQuery())&&(n.ceToolbar=i.first)}},exportAs:["ceToolbar"],ngContentSelectors:["[ceToolbar]"],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["elseBlock",""],["nzSize","small",1,"tool-bar"],[1,"d-flex","align-items-center","col","p-0"],[1,"ml-2"],[1,"d-flex","ml-auto","align-items-center"],["nz-button","","nzType","link",3,"disabled"],["nz-icon","","nzIconfont","icon-copy"],["nz-button","","nzType","link"],["nz-icon","","nzIconfont","icon-paste"],["nz-button","","nzType","link",3,"disabled","click"],["nz-icon","","nzIconfont","icon-group"],["nz-icon","","nzIconfont","icon-break"],["nz-icon","","nzIconfont","icon-horizontal-between"],["nz-icon","","nzIconfont","icon-horizontal-align"],["nz-icon","","nzIconfont","icon-vertical-between"],["nz-icon","","nzIconfont","icon-vertical-align"],["nz-icon","","nzIconfont","icon-left-align"],["nz-icon","","nzIconfont","icon-right-align"],["nz-icon","","nzIconfont","icon-top-align"],["nz-icon","","nzIconfont","icon-bottom-align"],["nzMode","checkable",3,"nzChecked","nzCheckedChange"],["nz-icon","","nzIconfont","icon-tuceng"],["nz-icon","","nzIconfont","icon-widgets"],["nz-icon","","nzIconfont","icon-widget"],["nz-icon","","nzIconfont","icon-run"]],template:function(e,n){if(1&e&&(t.ɵɵprojectionDef(gt),t.ɵɵtemplate(0,ft,2,0,"ng-container",0),t.ɵɵtemplate(1,mt,58,36,"ng-template",null,1,t.ɵɵtemplateRefExtractor)),2&e){var r=t.ɵɵreference(2);t.ɵɵproperty("ngIf",n.ceToolbar)("ngIfElse",r)}},directives:[a.NgIf,f.NzCardComponent,g.NzButtonComponent,p.ɵNzTransitionPatchDirective,u.NzIconDirective,P.NzTagComponent],pipes:[a.AsyncPipe],styles:["ce-toolbar{display:flex;flex:1;height:40px;max-height:40px;width:100%}ce-toolbar .tool-bar{flex:1}ce-toolbar .tool-bar [nz-icon]{font-size:18px}ce-toolbar .tool-bar nz-tag{margin:auto .2rem;padding:auto 2px}ce-toolbar .tool-bar nz-tag [nz-icon]{font-size:13px}ce-toolbar .tool-bar .ant-card-body{display:flex;height:100%;padding:2px 5px}"],encapsulation:2,changeDetection:0});var vt=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();vt.ɵfac=function(e){return new(e||vt)},vt.ɵcmp=t.ɵɵdefineComponent({type:vt,selectors:[["ce-widget-list"]],decls:2,vars:0,template:function(e,n){1&e&&(t.ɵɵelementStart(0,"p"),t.ɵɵtext(1,"widget-list works!"),t.ɵɵelementEnd())},styles:[""],encapsulation:2});var yt=["container"];function zt(e,n){if(1&e&&t.ɵɵelement(0,"div",14),2&e){var r=t.ɵɵnextContext();t.ɵɵstyleProp("left",r.selectorRect.x,"px")("top",r.selectorRect.y,"px")("width",r.selectorRect.width,"px")("height",r.selectorRect.height,"px")}}function St(e,n){if(1&e&&t.ɵɵelement(0,"ce-panel",16),2&e){var r=t.ɵɵnextContext().$implicit;t.ɵɵproperty("panel",r)}}function xt(e,n){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,St,1,1,"ce-panel",15),t.ɵɵelementContainerEnd()),2&e){var r=n.$implicit;t.ɵɵadvance(1),t.ɵɵproperty("ngIf",r.show)}}var wt=[[["","toolbar",""]]],Ot=function(){function e(e){var t=this;this.store=e,this.subscription=new o.Subscription,this.startPoints=[],this.selectorRect=null,this.nodesRectSnapshot=null,this.nodeIdList=null,this.store.select((function(e){return e.canvasPosition})).subscribe((function(e){t.canvasPosition=e,t.matrix="translate3d("+t.canvasPosition.left+"px,"+t.canvasPosition.top+"px,0)"})),this.store.select((function(e){return e.nodes})).subscribe((function(e){return t.nodes=e})),this.refLineState$=this.store.selectDifferent((function(e){return e.refLineState}))}return Object.defineProperty(e.prototype,"state",{set:function(e){var t;null===(t=this.store)||void 0===t||t.setState((function(t){return Object.assign(Object.assign({},t),e)}))},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.listenScaleEvent()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.panelsTrackByFn=function(e,t){return t.key+"_"+t.show.toString()},e.prototype.dragStart=function(e){this.startPoints=[e.clientX,e.clientY,this.canvasPosition.left,this.canvasPosition.top]},e.prototype.dragging=function(e){if(this.startPoints){var t=V(this.startPoints,4),n=t[0],r=t[1],i=t[2],o=t[3],a=V([e.clientX-n,e.clientY-r],2),s=a[0],l=a[1];this.store.dispatch(re({left:i+s,top:o+l}))}},e.prototype.dragEnd=function(){this.startPoints=null},e.prototype.listenScaleEvent=function(){var e=this,t=this.containerEleRef.nativeElement;this.subscription.add(o.fromEvent(t,"wheel").pipe(n.filter((function(e){return e.ctrlKey}))).subscribe((function(n){n.preventDefault(),n.stopPropagation();var r=t.getBoundingClientRect(),i=.05*(n.wheelDelta/120||-n.deltaY/3),o=V([n.clientX-r.left,n.clientY-r.top],2),a=o[0],s=o[1];e.canvasPosition.scale+i>=.2&&e.store.dispatch(re({scale:e.canvasPosition.scale+i,left:(e.canvasPosition.left-a)*(i/e.canvasPosition.scale)+e.canvasPosition.left,top:(e.canvasPosition.top-s)*(i/e.canvasPosition.scale)+e.canvasPosition.top}))})))},e.prototype.selectorStart=function(){var e=this;this.clearSelectAndBorder();var t=this.containerEleRef.nativeElement.getBoundingClientRect();this.nodesRectSnapshot=new Map,this.nodes.filter((function(e){return!e.locked})).forEach((function(n){var r,i=null===(r=document.querySelector("#box-item-"+n.id))||void 0===r?void 0:r.getBoundingClientRect();if(i){var o=i.width,a=i.height,s=i.left,l=i.top;e.nodesRectSnapshot.set(n.id,{width:o,height:a,left:s-t.left,top:l-t.top})}}))},e.prototype.selectorMoving=function(e){var t=this;this.selectorRect=e,this.nodeIdList=[],this.nodesRectSnapshot.forEach((function(e,n){(function(e,t){return e.left>=t.x&&e.top>=t.y&&e.left+e.width<=t.x+t.width&&e.top+e.height<=t.y+t.height})(e,t.selectorRect)&&t.nodeIdList.push(n)})),this.store.dispatch(ne(this.nodeIdList)),this.store.dispatch(Z(this.nodeIdList))},e.prototype.selectorEnd=function(){this.nodeIdList=[],this.selectorRect=null,this.nodesRectSnapshot=null},e.prototype.clearSelectAndBorder=function(){this.store.dispatch(J()),this.store.dispatch(X())},e}();Ot.ɵfac=function(e){return new(e||Ot)(t.ɵɵdirectiveInject(K))},Ot.ɵcmp=t.ɵɵdefineComponent({type:Ot,selectors:[["ce-editor"]],viewQuery:function(e,n){if(1&e&&t.ɵɵstaticViewQuery(yt,!0,t.ElementRef),2&e){var r;t.ɵɵqueryRefresh(r=t.ɵɵloadQuery())&&(n.containerEleRef=r.first)}},inputs:{state:"state"},exportAs:["ceEditor"],features:[t.ɵɵProvidersFeature([K])],ngContentSelectors:["[toolbar]"],decls:35,vars:60,consts:[[1,"col","p-0","d-flex"],["ceDraggable","","ceUseSpace","","ceSelector","",1,"canvas-container",3,"ceSelectorDisabled","ceOnStart","ceOnMove","ceOnStop","ceOnSelectorStart","ceOnSelectorMoving","ceOnSelectorStop"],["ceDrag","ceDraggable","container",""],[1,"canvas-content"],["ceNoZoomArea",""],["ceZoomArea",""],["cx","",1,"ref-line","y"],["cy","",1,"ref-line","x"],["tx","",1,"ref-line","y"],["bx","",1,"ref-line","y"],["ly","",1,"ref-line","x"],["ry","",1,"ref-line","x"],["class","selector",3,"left","top","width","height",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"selector"],[3,"panel",4,"ngIf"],[3,"panel"]],template:function(e,n){if(1&e&&(t.ɵɵprojectionDef(wt),t.ɵɵprojection(0),t.ɵɵelementStart(1,"div",0),t.ɵɵelementStart(2,"div",1,2),t.ɵɵlistener("ceOnStart",(function(e){return n.dragStart(e)}))("ceOnMove",(function(e){return n.dragging(e)}))("ceOnStop",(function(){return n.dragEnd()}))("ceOnSelectorStart",(function(){return n.selectorStart()}))("ceOnSelectorMoving",(function(e){return n.selectorMoving(e)}))("ceOnSelectorStop",(function(){return n.selectorEnd()})),t.ɵɵelementStart(5,"div",3),t.ɵɵelementStart(6,"div",4),t.ɵɵelement(7,"ce-canvas-background"),t.ɵɵelement(8,"ce-canvas-grid"),t.ɵɵelementEnd(),t.ɵɵelementStart(9,"div",5),t.ɵɵelement(10,"ce-canvas"),t.ɵɵelementEnd(),t.ɵɵelementStart(11,"div",4),t.ɵɵelement(12,"ce-bordered-area"),t.ɵɵelement(13,"ce-resize-handle"),t.ɵɵelement(14,"div",6),t.ɵɵpipe(15,"async"),t.ɵɵpipe(16,"async"),t.ɵɵelement(17,"div",7),t.ɵɵpipe(18,"async"),t.ɵɵpipe(19,"async"),t.ɵɵelement(20,"div",8),t.ɵɵpipe(21,"async"),t.ɵɵpipe(22,"async"),t.ɵɵelement(23,"div",9),t.ɵɵpipe(24,"async"),t.ɵɵpipe(25,"async"),t.ɵɵelement(26,"div",10),t.ɵɵpipe(27,"async"),t.ɵɵpipe(28,"async"),t.ɵɵelement(29,"div",11),t.ɵɵpipe(30,"async"),t.ɵɵpipe(31,"async"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(32,zt,1,8,"div",12),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(33,xt,2,1,"ng-container",13),t.ɵɵpipe(34,"async")),2&e){var r,i,o,a,s,l,c,d,p,u,h,f,m=t.ɵɵreference(3);t.ɵɵadvance(2),t.ɵɵclassProp("start-drag",m.spaceKeyDown)("dragging",n.startPoints),t.ɵɵproperty("ceSelectorDisabled",m.spaceKeyDown),t.ɵɵadvance(3),t.ɵɵstyleProp("transform",n.matrix),t.ɵɵadvance(9),t.ɵɵstyleProp("top",(null==(r=t.ɵɵpipeBind1(15,34,n.refLineState$))||null==r.cx?null:r.cx.position)*n.canvasPosition.scale,"px"),t.ɵɵclassProp("active",null==(i=t.ɵɵpipeBind1(16,36,n.refLineState$))||null==i.cx?null:i.cx.state),t.ɵɵadvance(3),t.ɵɵstyleProp("left",(null==(o=t.ɵɵpipeBind1(18,38,n.refLineState$))||null==o.cy?null:o.cy.position)*n.canvasPosition.scale,"px"),t.ɵɵclassProp("active",null==(a=t.ɵɵpipeBind1(19,40,n.refLineState$))||null==a.cy?null:a.cy.state),t.ɵɵadvance(3),t.ɵɵstyleProp("top",(null==(s=t.ɵɵpipeBind1(21,42,n.refLineState$))||null==s.tx?null:s.tx.position)*n.canvasPosition.scale,"px"),t.ɵɵclassProp("active",null==(l=t.ɵɵpipeBind1(22,44,n.refLineState$))||null==l.tx?null:l.tx.state),t.ɵɵadvance(3),t.ɵɵstyleProp("top",(null==(c=t.ɵɵpipeBind1(24,46,n.refLineState$))||null==c.bx?null:c.bx.position)*n.canvasPosition.scale,"px"),t.ɵɵclassProp("active",null==(d=t.ɵɵpipeBind1(25,48,n.refLineState$))||null==d.bx?null:d.bx.state),t.ɵɵadvance(3),t.ɵɵstyleProp("left",(null==(p=t.ɵɵpipeBind1(27,50,n.refLineState$))||null==p.ly?null:p.ly.position)*n.canvasPosition.scale,"px"),t.ɵɵclassProp("active",null==(u=t.ɵɵpipeBind1(28,52,n.refLineState$))||null==u.ly?null:u.ly.state),t.ɵɵadvance(3),t.ɵɵstyleProp("left",(null==(h=t.ɵɵpipeBind1(30,54,n.refLineState$))||null==h.ry?null:h.ry.position)*n.canvasPosition.scale,"px"),t.ɵɵclassProp("active",null==(f=t.ɵɵpipeBind1(31,56,n.refLineState$))||null==f.ry?null:f.ry.state),t.ɵɵadvance(3),t.ɵɵproperty("ngIf",n.selectorRect),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",t.ɵɵpipeBind1(34,58,n.store.panels$))("ngForTrackBy",n.panelsTrackByFn)}},directives:[de,pt,dt,Y,Q,ut,he,G,st,a.NgIf,a.NgForOf,Ie],pipes:[a.AsyncPipe],styles:['@import "styles/bootstrap.css";[nz-button]~[nz-button],[nz-icon]~[nz-icon]{margin-left:.5rem}.svg-icon{width:80px}.svg-icon>*{fill:currentColor}[ceNoZoomArea]{display:block;pointer-events:none}[ceNoZoomArea],[ceZoomArea]{position:absolute}.ant-tree .ant-tree-treenode{align-items:center}ce-editor{bottom:0;display:flex;flex-direction:column;height:100vh;left:0;overflow:hidden;position:absolute;right:0;top:0;width:100vw}ce-editor .left-side{width:300px}ce-editor .canvas-container{background-color:#f0f0f0;flex:1;overflow:hidden;position:relative}ce-editor .canvas-container.start-drag{cursor:grab}ce-editor .canvas-container.start-drag>*{pointer-events:none}ce-editor .canvas-container.start-drag.dragging{cursor:grabbing}ce-editor .canvas-container .canvas-content{position:absolute}ce-editor .canvas-container .selector{background-color:rgba(24,144,255,.3);border:1px solid #1890ff;box-sizing:border-box;position:absolute}ce-editor .canvas-container .ref-line{background-color:#fa8c16;display:none;opacity:.8;position:absolute;z-index:999999999999}ce-editor .canvas-container .ref-line.active{display:inline-block}ce-editor .canvas-container .ref-line.x{bottom:0;height:100%;top:0;width:1px}ce-editor .canvas-container .ref-line.y{height:1px;left:0;right:0;width:100%}ce-editor .aside{border:solid #f0f0f0;border-width:0 1px 0 0;display:flex}ce-editor .aside ul{list-style:none;margin:0;padding:0}ce-editor .aside ul li{align-items:center;border-bottom:1px solid #f0f0f0;display:flex;justify-content:center;margin:0;padding:3px 0;width:100%}'],encapsulation:2,changeDetection:0});var Pt=j,Et=Object.keys(Pt).map((function(e){return Pt[e]})),Ct=[g.NzButtonModule,f.NzCardModule,x.NzCollapseModule,I.NzDividerModule,d.NzDropDownModule,v.NzFormModule,u.NzIconModule,S.NzInputModule,z.NzInputNumberModule,s.NzPipesModule,O.NzSelectModule,w.NzSwitchModule,N.NzTabsModule,P.NzTagModule,k.NzToolTipModule,c.NzTreeModule],Mt=function(e){this.injector=e,this.injector.get(u.NzIconService).fetchFromIconfont({scriptUrl:"https://at.alicdn.com/t/font_1310204_lmnttxhl5lk.js"})};Mt.ɵmod=t.ɵɵdefineNgModule({type:Mt}),Mt.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||Mt)(t.ɵɵinject(t.Injector))},imports:[T(Ct,[u.NzIconModule.forRoot(Et)]),g.NzButtonModule,f.NzCardModule,x.NzCollapseModule,I.NzDividerModule,d.NzDropDownModule,v.NzFormModule,u.NzIconModule,S.NzInputModule,z.NzInputNumberModule,s.NzPipesModule,O.NzSelectModule,w.NzSwitchModule,N.NzTabsModule,P.NzTagModule,k.NzToolTipModule,c.NzTreeModule,u.NzIconModule]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(Mt,{imports:[g.NzButtonModule,f.NzCardModule,x.NzCollapseModule,I.NzDividerModule,d.NzDropDownModule,v.NzFormModule,u.NzIconModule,S.NzInputModule,z.NzInputNumberModule,s.NzPipesModule,O.NzSelectModule,w.NzSwitchModule,N.NzTabsModule,P.NzTagModule,k.NzToolTipModule,c.NzTreeModule,u.NzIconModule],exports:[g.NzButtonModule,f.NzCardModule,x.NzCollapseModule,I.NzDividerModule,d.NzDropDownModule,v.NzFormModule,u.NzIconModule,S.NzInputModule,z.NzInputNumberModule,s.NzPipesModule,O.NzSelectModule,w.NzSwitchModule,N.NzTabsModule,P.NzTagModule,k.NzToolTipModule,c.NzTreeModule,u.NzIconModule]});var It=[m.DragDropModule],Nt=function(){};Nt.ɵmod=t.ɵɵdefineNgModule({type:Nt}),Nt.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||Nt)},imports:[T([a.CommonModule,C.BrowserAnimationsModule,E.HttpClientModule,b.FormsModule,b.ReactiveFormsModule,Mt],It)]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(Nt,{declarations:[bt,xe,vt,he,Q,Y,U,st,ct,G,Ot,Ie,Xe,dt,ut,de,pt,ht,ke,We],imports:[a.CommonModule,C.BrowserAnimationsModule,E.HttpClientModule,b.FormsModule,b.ReactiveFormsModule,Mt,m.DragDropModule],exports:[bt,xe,vt,he,Q,Y,U,st,ct,G,Ot,Ie,Xe,dt,ut,de,pt,ht]}),t.ɵɵsetComponentScope(st,[a.NgIf,ct,de],[a.AsyncPipe]),e.AngularEditorLibComponent=Ot,e.AngularEditorLibModule=Nt,e.BorderedAreaComponent=G,e.BoxItemComponent=U,e.CanvasBackgroundComponent=Y,e.CanvasComponent=he,e.CanvasFormsComponent=ke,e.CanvasGridComponent=Q,e.CeToolbarDirective=ht,e.CeUtilsService=F,e.DEFAULT_STORE=A,e.DraggableDirective=de,e.EditorStore=K,e.LayerTreeComponent=xe,e.NoZoomAreaDirective=dt,e.PanelComponent=Ie,e.PropertyFormComponent=Xe,e.ResizeHandleComponent=st,e.RotateHandleComponent=ct,e.SelectorDirective=pt,e.ToolbarComponent=bt,e.WidgetFormComponent=We,e.WidgetListComponent=vt,e.ZoomAreaDirective=ut,e.genNodeId=$,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-editor-lib.umd.min.js.map